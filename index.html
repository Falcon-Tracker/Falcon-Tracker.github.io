<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Falcon Tracker - Advanced RTT Analysis Dashboard for monitoring device activity through silent delivery receipts on instant messengers">
    <meta name="keywords" content="Falcon Tracker, RTT Analysis, Device Tracking, WhatsApp, Signal, Threema, Delivery Receipts">
    <meta name="author" content="Falcon Tracker Team">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Falcon Tracker | RTT Analysis Dashboard">
    <meta property="og:description" content="Advanced device activity monitoring through RTT analysis of delivery receipts">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://res.cloudinary.com/dkj22lm1g/image/upload/v1768133460/Falcon_Tracker_cbgj3k.jpg">
    <meta property="og:image:alt" content="Falcon Tracker Logo">
    <meta property="og:url" content="https://falcon-tracker.github.io/">
    <meta property="og:site_name" content="Falcon Tracker">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Falcon Tracker | RTT Analysis Dashboard">
    <meta name="twitter:description" content="Advanced device activity monitoring through RTT analysis of delivery receipts">
    <meta name="twitter:image" content="https://res.cloudinary.com/dkj22lm1g/image/upload/v1768133460/Falcon_Tracker_cbgj3k.jpg">
    <meta name="twitter:image:alt" content="Falcon Tracker Logo">
    <link rel="canonical" href="https://falcon-tracker.github.io/">
    <meta name="theme-color" content="#00ff88">
    <link rel="icon" type="image/jpeg" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_32,h_32,c_fill/v1768133460/Falcon_Tracker_cbgj3k.jpg">
    <link rel="apple-touch-icon" href="https://res.cloudinary.com/dkj22lm1g/image/upload/w_180,h_180,c_fill/v1768133460/Falcon_Tracker_cbgj3k.jpg">
    <!-- PWA Support -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRmFsY29uIFRyYWNrZXIiLCJzaG9ydF9uYW1lIjoiRmFsY29uIiwiZGVzY3JpcHRpb24iOiJBZHZhbmNlZCBSVFQgQW5hbHlzaXMgRGFzaGJvYXJkIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMGYiLCJ0aGVtZV9jb2xvciI6IiMwMGZmODgiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9yZXMuY2xvdWRpbmFyeS5jb20vZGtqMjJsbTFnL2ltYWdlL3VwbG9hZC93XzE5MixoXzE5MixjX2ZpbGwvdjE3NjgxMzM0NjAvRmFsY29uX1RyYWNrZXJfY2JnajNrLmpwZyIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9qcGVnIn0seyJzcmMiOiJodHRwczovL3Jlcy5jbG91ZGluYXJ5LmNvbS9ka2oyMmxtMWcvaW1hZ2UvdXBsb2FkL3dfNTEyLGhfNTEyLGNfZmlsbC92MTc2ODEzMzQ2MC9GYWxjb25fVHJhY2tlcl9jYmdqM2suanBnIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL2pwZWcifV19">
    <title>Falcon Tracker | RTT Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Space Grotesk', 'sans-serif'],
                        sans: ['Instrument Sans', 'sans-serif'],
                    },
                    colors: {
                        cyber: {
                            dark: '#0a0a0f',
                            darker: '#050508',
                            card: '#12121a',
                            border: '#1f1f2e',
                            glow: '#00ff88',
                            warn: '#ffb800',
                            danger: '#ff3366',
                            info: '#00b4ff',
                            purple: '#9d4edd',
                        }
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
                        'scan': 'scan 3s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                        'radar': 'radar 2s linear infinite',
                    },
                    keyframes: {
                        'pulse-glow': {
                            '0%, 100%': { opacity: '1', boxShadow: '0 0 20px rgba(0, 255, 136, 0.4)' },
                            '50%': { opacity: '0.7', boxShadow: '0 0 40px rgba(0, 255, 136, 0.8)' }
                        },
                        'scan': {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'shimmer': {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        },
                        'radar': {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: radial-gradient(ellipse at top, #0f0f1a 0%, #050508 50%, #000 100%);
        }
        
        .grid-bg {
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        .glow-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
        }
        
        .card-glow {
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .status-online {
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }
        
        .status-standby {
            box-shadow: 0 0 20px rgba(255, 184, 0, 0.6);
        }
        
        .status-offline {
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.6);
        }
        
        .noise-overlay {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
        }
        
        .shimmer-bg {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
        }
        
        .radar-sweep {
            background: conic-gradient(from 0deg, transparent, rgba(0, 255, 136, 0.3), transparent 30deg);
        }
        
        .qr-placeholder {
            background: repeating-linear-gradient(
                45deg,
                #1a1a2e,
                #1a1a2e 10px,
                #0f0f1a 10px,
                #0f0f1a 20px
            );
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0a0a0f;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #1f1f2e;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2f2f4e;
        }
        
        .activity-bar {
            transition: all 0.3s ease;
        }
        
        .activity-bar:hover {
            filter: brightness(1.3);
            transform: scaleY(1.1);
        }
        
        /* Toast notification styles */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 60;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            max-width: 350px;
        }
        
        .toast.success {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }
        
        .toast.error {
            background: rgba(255, 51, 102, 0.15);
            border: 1px solid rgba(255, 51, 102, 0.3);
            color: #ff3366;
        }
        
        .toast.warning {
            background: rgba(255, 184, 0, 0.15);
            border: 1px solid rgba(255, 184, 0, 0.3);
            color: #ffb800;
        }
        
        .toast.info {
            background: rgba(0, 180, 255, 0.15);
            border: 1px solid rgba(0, 180, 255, 0.3);
            color: #00b4ff;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Input validation styles */
        .input-valid {
            border-color: #00ff88 !important;
        }
        
        .input-invalid {
            border-color: #ff3366 !important;
        }
        
        .validation-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* Privacy mode blur */
        .privacy-blur {
            filter: blur(8px);
            user-select: none;
        }
        
        /* Network indicator pulse */
        .network-excellent { color: #00ff88; }
        .network-good { color: #00b4ff; }
        .network-fair { color: #ffb800; }
        .network-poor { color: #ff3366; }
        
        /* Recent targets dropdown */
        .recent-targets-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #12121a;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            margin-top: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 20;
        }
        
        .recent-target-item {
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .recent-target-item:hover {
            background: rgba(0, 255, 136, 0.1);
        }
        
        .recent-target-item:first-child {
            border-radius: 12px 12px 0 0;
        }
        
        .recent-target-item:last-child {
            border-radius: 0 0 12px 12px;
        }
        
        /* ===== NEW FEATURE STYLES ===== */
        
        /* Heatmap Calendar */
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(53, 1fr);
            gap: 2px;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 2px;
            transition: all 0.2s;
            cursor: pointer;
            min-width: 8px;
            min-height: 8px;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.3);
            z-index: 10;
        }
        
        .heatmap-level-0 { background: #1f1f2e; }
        .heatmap-level-1 { background: rgba(0, 255, 136, 0.2); }
        .heatmap-level-2 { background: rgba(0, 255, 136, 0.4); }
        .heatmap-level-3 { background: rgba(0, 255, 136, 0.6); }
        .heatmap-level-4 { background: rgba(0, 255, 136, 0.8); }
        .heatmap-level-5 { background: #00ff88; }
        
        /* High Contrast Mode */
        .high-contrast body { background: #000 !important; }
        .high-contrast .bg-cyber-card { background: #000 !important; border-color: #fff !important; }
        .high-contrast .text-gray-400, .high-contrast .text-gray-500 { color: #fff !important; }
        
        /* Reduced Motion Mode */
        .reduced-motion * { animation: none !important; transition: none !important; }
        
        /* Fullscreen Mode */
        .fullscreen-mode {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 100;
            background: #0a0a0f;
            overflow: auto;
            padding: 20px;
        }
        
        /* PIN Lock Screen */
        .lock-screen {
            position: fixed;
            inset: 0;
            background: #0a0a0f;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        
        .pin-input { display: flex; gap: 10px; justify-content: center; }
        
        .pin-digit {
            width: 50px; height: 60px;
            text-align: center;
            font-size: 24px;
            background: #12121a;
            border: 2px solid #1f1f2e;
            border-radius: 12px;
            color: #00ff88;
        }
        
        .pin-digit:focus { border-color: #00ff88; outline: none; }
        
        /* Session Tags */
        .session-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .session-tag:hover { opacity: 0.8; }
        
        .tag-important { background: rgba(255, 51, 102, 0.2); color: #ff3366; }
        .tag-sleep { background: rgba(157, 78, 221, 0.2); color: #9d4edd; }
        .tag-travel { background: rgba(0, 180, 255, 0.2); color: #00b4ff; }
        .tag-work { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        
        /* Alert Rules */
        .alert-rule { border-left: 3px solid; padding-left: 12px; }
        .alert-rule-active { border-color: #00ff88; }
        .alert-rule-inactive { border-color: #666; }
        
        /* Confidence Ring */
        .confidence-ring {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            transition: stroke-dashoffset 1s ease;
        }
        
        /* Stealth Mode */
        .stealth-mode { background: #000 !important; }
        .stealth-mode * { visibility: hidden; }
        .stealth-mode:hover * { visibility: visible; }
        
        /* Font Size Controls */
        .font-size-small { font-size: 12px; }
        .font-size-normal { font-size: 14px; }
        .font-size-large { font-size: 16px; }
        .font-size-xlarge { font-size: 18px; }
        
        /* Settings Tabs */
        .settings-tab { transition: opacity 0.2s; }
        
        /* Histogram Bars */
        .histogram-bar { transition: all 0.3s ease; }
        .histogram-bar:hover { filter: brightness(1.2); }
    </style>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Falcon Tracker",
        "description": "Advanced RTT Analysis Dashboard for monitoring device activity through silent delivery receipts on instant messengers",
        "url": "https://falcon-tracker.github.io/",
        "applicationCategory": "SecurityApplication",
        "operatingSystem": "Web Browser",
        "image": "https://res.cloudinary.com/dkj22lm1g/image/upload/v1768133460/Falcon_Tracker_cbgj3k.jpg",
        "author": {
            "@type": "Organization",
            "name": "Falcon Tracker Team"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body class="min-h-screen font-sans text-white overflow-x-hidden">
    <div class="noise-overlay fixed inset-0 pointer-events-none z-50"></div>
    <div class="grid-bg fixed inset-0 pointer-events-none"></div>
    
    <!-- Legal Disclaimer Modal (Ethical Considerations) -->
    <div id="legal-disclaimer-modal" class="fixed inset-0 bg-black/95 backdrop-blur-sm z-[300] flex items-center justify-center p-6" role="dialog" aria-modal="true" aria-labelledby="disclaimer-title">
        <div class="bg-cyber-card rounded-2xl border border-cyber-danger/50 max-w-lg w-full p-8 relative">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-cyber-danger/20 flex items-center justify-center">
                    <svg class="w-10 h-10 text-cyber-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h2 id="disclaimer-title" class="font-display text-2xl font-bold text-cyber-danger mb-2">⚠️ Legal Disclaimer</h2>
                <p class="text-gray-400 text-sm">Please read and acknowledge before proceeding</p>
            </div>
            
            <div class="space-y-4 text-sm text-gray-300 max-h-60 overflow-y-auto mb-6 p-4 bg-cyber-darker rounded-lg">
                <p><strong class="text-white">Educational & Research Tool Only:</strong> Falcon Tracker is designed for educational and security research purposes based on the "Careless Whisper" academic research.</p>
                
                <p><strong class="text-cyber-danger">Legal Requirements:</strong></p>
                <ul class="list-disc list-inside ml-2 space-y-1 text-gray-400">
                    <li>You MUST have explicit consent from any individual you monitor</li>
                    <li>Unauthorized surveillance may violate local, state, and federal laws</li>
                    <li>This includes but not limited to: CFAA, ECPA, GDPR, and similar regulations</li>
                    <li>Penalties may include criminal prosecution and civil liability</li>
                </ul>
                
                <p><strong class="text-cyber-warn">Acceptable Use:</strong></p>
                <ul class="list-disc list-inside ml-2 space-y-1 text-gray-400">
                    <li>Testing your own devices and accounts</li>
                    <li>Academic research with proper IRB approval</li>
                    <li>Security auditing with written authorization</li>
                    <li>Parental monitoring where legally permitted</li>
                </ul>
                
                <p><strong class="text-white">Data Handling:</strong> All data is stored locally in your browser. We do not collect, transmit, or store any tracking data on external servers.</p>
            </div>
            
            <div class="space-y-3">
                <label class="flex items-start gap-3 cursor-pointer">
                    <input type="checkbox" id="consent-checkbox" class="mt-1 w-5 h-5 rounded border-cyber-border bg-cyber-darker text-cyber-glow focus:ring-cyber-glow">
                    <span class="text-sm text-gray-300">I confirm that I have read, understood, and agree to comply with all applicable laws. I will only use this tool for legitimate purposes with proper consent.</span>
                </label>
            </div>
            
            <button onclick="acceptDisclaimer()" id="accept-disclaimer-btn" disabled class="w-full mt-6 py-3 bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30 rounded-xl font-medium transition-colors disabled:opacity-30 disabled:cursor-not-allowed hover:bg-cyber-glow/30">
                I Accept - Enter Dashboard
            </button>
            
            <p class="text-center text-xs text-gray-500 mt-4">By clicking "I Accept", you acknowledge legal responsibility for your use of this tool.</p>
        </div>
    </div>
    
    <!-- PIN Lock Screen -->
    <div id="pin-lock-screen" class="lock-screen hidden">
        <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-cyber-glow/20 flex items-center justify-center">
                <svg class="w-10 h-10 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
            </div>
            <h2 class="font-display text-xl font-semibold mb-2">Dashboard Locked</h2>
            <p class="text-gray-500 text-sm mb-6">Enter your PIN to unlock</p>
            
            <div class="pin-input mb-4">
                <input type="password" maxlength="1" class="pin-digit" data-index="0" oninput="handlePinInput(this)" onkeydown="handlePinKeydown(event, this)" aria-label="PIN digit 1">
                <input type="password" maxlength="1" class="pin-digit" data-index="1" oninput="handlePinInput(this)" onkeydown="handlePinKeydown(event, this)" aria-label="PIN digit 2">
                <input type="password" maxlength="1" class="pin-digit" data-index="2" oninput="handlePinInput(this)" onkeydown="handlePinKeydown(event, this)" aria-label="PIN digit 3">
                <input type="password" maxlength="1" class="pin-digit" data-index="3" oninput="handlePinInput(this)" onkeydown="handlePinKeydown(event, this)" aria-label="PIN digit 4">
            </div>
            
            <p id="pin-error" class="text-cyber-danger text-sm hidden">Incorrect PIN. Please try again.</p>
        </div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>
    
    <!-- Header -->
    <header class="relative border-b border-cyber-border/50 backdrop-blur-xl bg-cyber-dark/80 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="relative w-12 h-12 rounded-xl bg-gradient-to-br from-cyber-glow/20 to-cyber-purple/20 border border-cyber-glow/30 flex items-center justify-center overflow-hidden" role="img" aria-label="Falcon Tracker Logo">
                        <div class="absolute inset-0 radar-sweep animate-radar"></div>
                        <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_96,h_96,c_fill,q_auto,f_auto/v1768133460/Falcon_Tracker_cbgj3k.jpg" alt="Falcon Tracker Logo" class="w-full h-full object-cover rounded-xl relative z-10" width="48" height="48">
                    </div>
                    <div>
                        <h1 class="font-display text-xl font-semibold tracking-tight">Falcon Tracker</h1>
                        <p class="text-xs text-gray-500 font-mono">RTT Analysis Dashboard v2.0</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <!-- Network Quality Indicator -->
                    <div id="network-indicator" class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-cyber-card border border-cyber-border" role="status" aria-label="Network quality">
                        <svg class="w-4 h-4 network-excellent" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
                        </svg>
                        <span class="text-xs font-mono text-gray-400" id="network-quality">Excellent</span>
                    </div>
                    
                    <!-- Accessibility Menu -->
                    <div class="relative">
                        <button onclick="toggleAccessibilityMenu()" id="accessibility-btn" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-info/50 transition-colors" aria-label="Accessibility options" title="Accessibility (Alt+A)">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                        </button>
                        <div id="accessibility-menu" class="hidden absolute right-0 top-full mt-2 w-64 bg-cyber-card border border-cyber-border rounded-xl shadow-xl z-50 p-3">
                            <h4 class="text-sm font-semibold mb-3">Accessibility</h4>
                            <div class="space-y-2">
                                <button onclick="toggleHighContrast()" class="w-full flex items-center justify-between p-2 rounded-lg hover:bg-cyber-darker text-sm">
                                    <span>High Contrast</span>
                                    <span id="high-contrast-status" class="text-xs text-gray-500">Off</span>
                                </button>
                                <button onclick="toggleReducedMotion()" class="w-full flex items-center justify-between p-2 rounded-lg hover:bg-cyber-darker text-sm">
                                    <span>Reduced Motion</span>
                                    <span id="reduced-motion-status" class="text-xs text-gray-500">Off</span>
                                </button>
                                <div class="p-2">
                                    <label class="text-sm block mb-2">Font Size</label>
                                    <select id="font-size-select" onchange="changeFontSize(this.value)" class="w-full px-3 py-2 bg-cyber-darker border border-cyber-border rounded-lg text-sm">
                                        <option value="small">Small</option>
                                        <option value="normal" selected>Normal</option>
                                        <option value="large">Large</option>
                                        <option value="xlarge">Extra Large</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fullscreen Toggle -->
                    <button onclick="toggleFullscreen()" id="fullscreen-btn" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-glow/50 transition-colors" aria-label="Toggle fullscreen" title="Fullscreen (F11)">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                        </svg>
                    </button>
                    
                    <!-- Stealth Mode Toggle -->
                    <button onclick="toggleStealthMode()" id="stealth-btn" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-purple/50 transition-colors" aria-label="Toggle stealth mode" title="Stealth Mode">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                        </svg>
                    </button>
                    
                    <!-- Privacy Mode Toggle -->
                    <button onclick="togglePrivacyMode()" id="privacy-toggle" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-purple/50 transition-colors" aria-label="Toggle privacy mode" title="Privacy Mode (Ctrl+P)">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="privacy-icon">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                    </button>
                    
                    <div id="connection-status" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-cyber-card border border-cyber-border" role="status" aria-live="polite">
                        <span class="w-2 h-2 rounded-full bg-gray-500 animate-pulse" id="status-dot" aria-hidden="true"></span>
                        <span class="text-sm font-mono text-gray-400" id="status-text">Disconnected</span>
                    </div>
                    <button onclick="toggleHelp()" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-info/50 transition-colors" aria-label="Show keyboard shortcuts" title="Keyboard Shortcuts (?)">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                    <button onclick="toggleSettings()" class="p-2 rounded-lg bg-cyber-card border border-cyber-border hover:border-cyber-glow/50 transition-colors" aria-label="Open settings">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Platform Selector -->
        <div class="flex flex-wrap items-center gap-4 mb-8">
            <div class="flex bg-cyber-card rounded-xl p-1 border border-cyber-border" role="tablist" aria-label="Select messaging platform">
                <button onclick="selectPlatform('whatsapp')" id="btn-whatsapp" role="tab" aria-selected="true" class="platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                    </svg>
                    <span class="hidden sm:inline">WhatsApp</span>
                </button>
                <button onclick="selectPlatform('signal')" id="btn-signal" role="tab" aria-selected="false" class="platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 text-gray-400 hover:text-white">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 3.6c4.636 0 8.4 3.764 8.4 8.4 0 4.636-3.764 8.4-8.4 8.4-4.636 0-8.4-3.764-8.4-8.4 0-4.636 3.764-8.4 8.4-8.4zm0 2.4a6 6 0 100 12 6 6 0 000-12z"/>
                    </svg>
                    <span class="hidden sm:inline">Signal</span>
                </button>
                <button onclick="selectPlatform('threema')" id="btn-threema" role="tab" aria-selected="false" class="platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 text-gray-400 hover:text-white">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm-2 16h-2v-2h2v2zm0-4h-2V8h2v4zm4 4h-2v-2h2v2zm0-4h-2V8h2v4zm4 4h-2v-2h2v2zm0-4h-2V8h2v4z"/>
                    </svg>
                    <span class="hidden sm:inline">Threema</span>
                </button>
            </div>
            <div class="h-8 w-px bg-cyber-border hidden sm:block" aria-hidden="true"></div>
            <span class="text-sm text-gray-500 font-mono">Platform: <span id="current-platform" class="text-cyber-glow">WhatsApp</span></span>
        </div>
        
        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Left Column - QR & Connection -->
            <div class="space-y-6">
                <!-- QR Code Card -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6 card-glow relative overflow-hidden">
                    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-cyber-glow/50 to-transparent"></div>
                    
                    <h2 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h2M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
                        </svg>
                        Authentication
                    </h2>
                    
                    <div id="qr-container" class="relative aspect-square max-w-[240px] mx-auto rounded-xl overflow-hidden bg-white p-4">
                        <div id="qr-placeholder" class="w-full h-full flex items-center justify-center">
                            <div class="text-center">
                                <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-cyber-glow/10 flex items-center justify-center">
                                    <svg class="w-8 h-8 text-cyber-glow animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <p class="text-gray-800 text-sm font-medium">Scan with your phone</p>
                                <p class="text-gray-500 text-xs mt-1">Open Messenger &gt; Settings &gt; Linked Devices</p>
                            </div>
                        </div>
                        <canvas id="qr-canvas" class="hidden w-full h-full"></canvas>
                    </div>
                    
                    <div id="auth-status" class="mt-4 text-center">
                        <button onclick="generateQR()" class="px-4 py-2 bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30 rounded-lg text-sm font-medium hover:bg-cyber-glow/30 transition-colors">
                            Generate QR Code
                        </button>
                    </div>
                </div>
                
                <!-- Target Input -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6 card-glow">
                    <h2 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-info" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        Target Device
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-sm text-gray-400 font-mono">Phone Number</label>
                                <button onclick="toggleRecentTargets()" id="recent-targets-btn" class="text-xs text-cyber-info hover:text-cyber-glow transition-colors flex items-center gap-1" title="Recent targets">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Recent
                                </button>
                            </div>
                            <div class="relative">
                                <div class="flex gap-2">
                                    <div class="relative w-24">
                                        <input type="text" id="country-code" value="+1" oninput="validateCountryCode()" class="w-full px-3 py-3 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono focus:border-cyber-glow focus:outline-none focus:ring-1 focus:ring-cyber-glow/50" aria-label="Country code">
                                    </div>
                                    <div class="relative flex-1">
                                        <input type="tel" id="phone-number" placeholder="7012345678" oninput="validatePhoneNumber()" onfocus="showRecentTargets()" class="w-full px-4 py-3 pr-10 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono placeholder-gray-600 focus:border-cyber-glow focus:outline-none focus:ring-1 focus:ring-cyber-glow/50 privacy-target" aria-label="Phone number">
                                        <span id="phone-validation-icon" class="validation-icon hidden"></span>
                                    </div>
                                </div>
                                <!-- Recent Targets Dropdown -->
                                <div id="recent-targets-dropdown" class="recent-targets-dropdown hidden">
                                    <div id="recent-targets-list"></div>
                                    <div class="p-2 border-t border-cyber-border">
                                        <button onclick="clearRecentTargets()" class="w-full text-xs text-gray-500 hover:text-cyber-danger transition-colors py-1">Clear History</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-2">
                                <p id="phone-validation-msg" class="text-xs text-gray-500 font-mono">Format: Country code + number (e.g., +1 7012345678)</p>
                            </div>
                        </div>
                        
                        <button onclick="startTracking()" id="start-tracking-btn" class="w-full py-3 bg-gradient-to-r from-cyber-glow/20 to-cyber-purple/20 text-cyber-glow border border-cyber-glow/30 rounded-xl font-medium hover:from-cyber-glow/30 hover:to-cyber-purple/30 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Start Tracking
                        </button>
                        
                        <!-- Print Report Button -->
                        <button onclick="printReport()" id="print-report-btn" class="w-full py-2.5 bg-cyber-darker border border-cyber-border rounded-xl font-medium text-gray-400 hover:text-white hover:border-cyber-info/50 transition-all duration-300 flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                            </svg>
                            Print Report
                        </button>
                    </div>
                </div>
                
                <!-- Probe Method -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h2 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Probe Method
                    </h2>
                    
                    <div class="space-y-3" role="radiogroup" aria-label="Select probe method">
                        <label class="flex items-center gap-3 p-3 rounded-xl bg-cyber-darker border border-cyber-border cursor-pointer hover:border-cyber-glow/30 transition-colors probe-option" data-method="delete">
                            <input type="radio" name="probe-method" value="delete" checked class="sr-only">
                            <div class="w-5 h-5 rounded-full border-2 border-cyber-glow flex items-center justify-center" aria-hidden="true">
                                <div class="w-2.5 h-2.5 rounded-full bg-cyber-glow"></div>
                            </div>
                            <div>
                                <p class="font-medium">Silent Delete</p>
                                <p class="text-xs text-gray-500">Covert - sends delete request for non-existent message</p>
                            </div>
                        </label>
                        
                        <label class="flex items-center gap-3 p-3 rounded-xl bg-cyber-darker border border-cyber-border cursor-pointer hover:border-cyber-glow/30 transition-colors probe-option" data-method="reaction">
                            <input type="radio" name="probe-method" value="reaction" class="sr-only">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-600 flex items-center justify-center" aria-hidden="true">
                                <div class="w-2.5 h-2.5 rounded-full bg-transparent"></div>
                            </div>
                            <div>
                                <p class="font-medium">Self-Reaction</p>
                                <p class="text-xs text-gray-500">Covert - reacts to own message (no notification)</p>
                            </div>
                        </label>
                        
                        <label class="flex items-center gap-3 p-3 rounded-xl bg-cyber-darker border border-cyber-border cursor-pointer hover:border-cyber-glow/30 transition-colors probe-option" data-method="edit">
                            <input type="radio" name="probe-method" value="edit" class="sr-only">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-600 flex items-center justify-center" aria-hidden="true">
                                <div class="w-2.5 h-2.5 rounded-full bg-transparent"></div>
                            </div>
                            <div>
                                <p class="font-medium">Message Edit</p>
                                <p class="text-xs text-gray-500">Semi-covert - edit triggers delivery receipt</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="mt-4 p-3 rounded-xl bg-cyber-warn/10 border border-cyber-warn/20" role="alert">
                        <p class="text-xs text-cyber-warn flex items-start gap-2">
                            <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            <span>For educational and research purposes only. Based on "Careless Whisper" research. Never track without consent.</span>
                        </p>
                    </div>
                </div>
                
                <!-- Multi-Device Sessions (From Research) -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h2 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-info" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Detected Devices
                    </h2>
                    <p class="text-xs text-gray-500 mb-3">Multi-device tracking via independent delivery receipts</p>
                    
                    <div id="device-sessions" class="space-y-2">
                        <div class="p-3 rounded-lg bg-cyber-darker border border-cyber-border flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-xl" aria-label="Smartphone">📱</span>
                                <div>
                                    <p class="text-sm font-medium">Primary Device</p>
                                    <p class="text-xs text-gray-500">Waiting for detection...</p>
                                </div>
                            </div>
                            <span class="w-2 h-2 rounded-full bg-gray-600" aria-label="Status unknown"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Column - Main Dashboard -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Device Status Card -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6 card-glow relative overflow-hidden">
                    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-cyber-glow/50 to-transparent" aria-hidden="true"></div>
                    
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-display text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            Device Status
                        </h2>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-500 font-mono" id="last-update">Last update: --:--:--</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Status Indicator -->
                        <div class="md:col-span-1">
                            <div id="status-card" class="relative p-6 rounded-xl bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700/50 text-center" role="status" aria-live="polite">
                                <div id="status-icon" class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-700/50 flex items-center justify-center">
                                    <span class="text-4xl" id="status-emoji" aria-hidden="true">📵</span>
                                </div>
                                <p class="text-2xl font-display font-bold" id="status-label">Waiting...</p>
                                <p class="text-sm text-gray-400 mt-1 font-mono" id="status-jid">No target selected</p>
                                
                                <!-- Screen State Indicator (from research) -->
                                <div class="mt-3 pt-3 border-t border-gray-700/50">
                                    <div class="flex items-center justify-center gap-2">
                                        <span class="text-xs text-gray-500">Screen:</span>
                                        <span id="screen-state" class="text-xs font-mono px-2 py-0.5 rounded bg-gray-700 text-gray-400">Unknown</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- OS Fingerprint (from research) -->
                            <div class="mt-4 p-3 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-2">OS Fingerprint</p>
                                <div class="flex items-center gap-2" id="os-fingerprint">
                                    <span class="text-lg" id="os-icon" aria-hidden="true">❓</span>
                                    <span class="text-sm font-medium" id="os-name">Detecting...</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Metrics Grid -->
                        <div class="md:col-span-2 grid grid-cols-2 gap-4">
                            <div class="p-4 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-1">Current RTT</p>
                                <p class="text-2xl font-display font-bold text-cyber-glow" id="current-rtt">--</p>
                                <p class="text-xs text-gray-500">ms</p>
                            </div>
                            <div class="p-4 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-1">Moving Avg (3)</p>
                                <p class="text-2xl font-display font-bold text-cyber-info" id="moving-avg">--</p>
                                <p class="text-xs text-gray-500">ms</p>
                            </div>
                            <div class="p-4 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-1">Median RTT</p>
                                <p class="text-2xl font-display font-bold text-cyber-purple" id="median-rtt">--</p>
                                <p class="text-xs text-gray-500">ms</p>
                            </div>
                            <div class="p-4 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-1">Threshold</p>
                                <p class="text-2xl font-display font-bold text-cyber-warn" id="threshold">--</p>
                                <p class="text-xs text-gray-500">ms (Screen On/Off)</p>
                            </div>
                            
                            <!-- Statistics Summary -->
                            <div class="col-span-2 p-4 rounded-xl bg-cyber-darker border border-cyber-border">
                                <p class="text-xs text-gray-500 font-mono mb-3">Session Statistics</p>
                                <div class="grid grid-cols-4 gap-3 text-center">
                                    <div>
                                        <p class="text-lg font-bold text-cyber-glow" id="stat-online">0</p>
                                        <p class="text-xs text-gray-500">Online</p>
                                    </div>
                                    <div>
                                        <p class="text-lg font-bold text-cyber-warn" id="stat-standby">0</p>
                                        <p class="text-xs text-gray-500">Standby</p>
                                    </div>
                                    <div>
                                        <p class="text-lg font-bold text-cyber-danger" id="stat-offline">0</p>
                                        <p class="text-xs text-gray-500">Offline</p>
                                    </div>
                                    <div>
                                        <p class="text-lg font-bold text-cyber-info" id="stat-total">0</p>
                                        <p class="text-xs text-gray-500">Total</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- RTT Chart -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-display text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyber-info" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                            </svg>
                            RTT History
                        </h2>
                        <div class="flex items-center gap-2">
                            <button onclick="exportData()" class="px-3 py-1.5 text-xs bg-cyber-darker border border-cyber-border rounded-lg text-gray-400 hover:text-white hover:border-cyber-info/50 transition-colors flex items-center gap-1" aria-label="Export data as CSV">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                Export
                            </button>
                            <button onclick="clearHistory()" class="px-3 py-1.5 text-xs bg-cyber-darker border border-cyber-border rounded-lg text-gray-400 hover:text-white hover:border-gray-500 transition-colors">
                                Clear
                            </button>
                            <select id="chart-timeframe" onchange="updateChartTimeframe()" class="px-3 py-1.5 text-xs bg-cyber-darker border border-cyber-border rounded-lg text-gray-400 focus:outline-none" aria-label="Select chart timeframe">
                                <option value="50">Last 50</option>
                                <option value="100" selected>Last 100</option>
                                <option value="200">Last 200</option>
                            </select>
                        </div>
                    </div>
                    <div class="relative h-64">
                        <canvas id="rtt-chart" aria-label="RTT History Chart"></canvas>
                    </div>
                </div>
                
                <!-- Activity Timeline -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-display text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyber-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Activity Timeline (24h)
                        </h2>
                        <span class="text-xs text-gray-500">Screen On/Off patterns based on RTT</span>
                    </div>
                    
                    <div class="flex items-end gap-1 h-32" id="activity-timeline" role="img" aria-label="24-hour activity timeline showing device status">
                        <!-- Activity bars will be inserted here -->
                    </div>
                    
                    <div class="flex justify-between mt-2 text-xs text-gray-500 font-mono" aria-hidden="true">
                        <span>00:00</span>
                        <span>06:00</span>
                        <span>12:00</span>
                        <span>18:00</span>
                        <span>23:59</span>
                    </div>
                    
                    <div class="flex items-center justify-center gap-6 mt-4">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded bg-cyber-glow" aria-hidden="true"></div>
                            <span class="text-xs text-gray-400">Screen On (RTT &lt; threshold)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded bg-cyber-warn" aria-hidden="true"></div>
                            <span class="text-xs text-gray-400">Standby (1x-3x threshold)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded bg-cyber-danger" aria-hidden="true"></div>
                            <span class="text-xs text-gray-400">Offline (RTT &gt; 3x threshold)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Event Log -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-display text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyber-warn" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Event Log
                        </h2>
                        <div class="flex gap-2">
                            <button onclick="bookmarkCurrentEvent()" class="text-xs text-cyber-info hover:text-cyber-glow transition-colors" title="Bookmark">🔖</button>
                            <button onclick="clearLogs()" class="text-xs text-gray-500 hover:text-gray-300 transition-colors">Clear All</button>
                        </div>
                    </div>
                    
                    <div id="event-log" class="space-y-2 max-h-64 overflow-y-auto pr-2 font-mono text-sm">
                        <div class="text-gray-500 text-center py-8">No events yet. Start tracking to see activity logs.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== ADVANCED ANALYTICS SECTION ===== -->
        <div class="mt-8">
            <h2 class="font-display text-2xl font-bold mb-6 flex items-center gap-3">
                <svg class="w-7 h-7 text-cyber-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                Advanced Analytics
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Heatmap Calendar -->
                <div class="lg:col-span-2 bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-display text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Activity Heatmap Calendar
                        </h3>
                        <span class="text-xs text-gray-500">Last 365 days</span>
                    </div>
                    <div id="heatmap-calendar" class="heatmap-container mb-4"></div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 text-xs text-gray-500">
                            <span>Less</span>
                            <div class="flex gap-1">
                                <div class="w-3 h-3 rounded heatmap-level-0"></div>
                                <div class="w-3 h-3 rounded heatmap-level-1"></div>
                                <div class="w-3 h-3 rounded heatmap-level-2"></div>
                                <div class="w-3 h-3 rounded heatmap-level-3"></div>
                                <div class="w-3 h-3 rounded heatmap-level-4"></div>
                                <div class="w-3 h-3 rounded heatmap-level-5"></div>
                            </div>
                            <span>More</span>
                        </div>
                        <span class="text-xs text-gray-400">Total: <span id="total-activity-count" class="text-cyber-glow font-mono">0</span></span>
                    </div>
                </div>
                
                <!-- Sleep Pattern Detection -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                        </svg>
                        Sleep Pattern Analysis
                    </h3>
                    <div class="space-y-4">
                        <div class="p-3 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500 mb-1">Estimated Sleep Window</p>
                            <p class="text-lg font-mono text-cyber-purple" id="sleep-window">--:-- - --:--</p>
                        </div>
                        <div class="p-3 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500 mb-1">Average Sleep Duration</p>
                            <p class="text-lg font-mono text-cyber-info" id="avg-sleep-duration">-- hours</p>
                        </div>
                        <div class="p-3 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500 mb-1">Detected Timezone</p>
                            <p class="text-lg font-mono text-cyber-warn" id="detected-timezone">Analyzing...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Peak Activity Hours -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-warn" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Peak Activity Hours
                    </h3>
                    <div id="peak-hours-chart" class="h-32 flex items-end gap-1 mb-4"></div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-3 rounded-lg bg-cyber-darker text-center">
                            <p class="text-xs text-gray-500">Most Active</p>
                            <p class="text-lg font-mono text-cyber-glow" id="most-active-hour">--:00</p>
                        </div>
                        <div class="p-3 rounded-lg bg-cyber-darker text-center">
                            <p class="text-xs text-gray-500">Least Active</p>
                            <p class="text-lg font-mono text-cyber-danger" id="least-active-hour">--:00</p>
                        </div>
                    </div>
                </div>
                
                <!-- RTT Distribution Histogram -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-info" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        RTT Distribution
                    </h3>
                    <div id="rtt-histogram" class="h-32 flex items-end gap-1 mb-4"></div>
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div class="p-2 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500">Min</p>
                            <p class="text-sm font-mono text-cyber-glow" id="rtt-min">--ms</p>
                        </div>
                        <div class="p-2 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500">Avg</p>
                            <p class="text-sm font-mono text-cyber-info" id="rtt-avg">--ms</p>
                        </div>
                        <div class="p-2 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500">Max</p>
                            <p class="text-sm font-mono text-cyber-danger" id="rtt-max">--ms</p>
                        </div>
                        <div class="p-2 rounded-lg bg-cyber-darker">
                            <p class="text-xs text-gray-500">StdDev</p>
                            <p class="text-sm font-mono text-cyber-warn" id="rtt-std-dev">±--ms</p>
                        </div>
                    </div>
                </div>
                
                <!-- Behavioral Analytics -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Behavioral Analytics
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                            <span class="text-sm text-gray-400">Usage Score</span>
                            <span class="text-lg font-mono text-cyber-glow" id="usage-frequency-score">--/100</span>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                            <span class="text-sm text-gray-400">Predictive Status</span>
                            <span class="text-sm font-mono text-cyber-info" id="predictive-status">Calculating...</span>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                            <span class="text-sm text-gray-400">Avg Session</span>
                            <span class="text-sm font-mono text-cyber-warn" id="avg-session-duration">--min</span>
                        </div>
                        <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                            <span class="text-sm text-gray-400">Network Type</span>
                            <span class="text-sm font-mono text-cyber-purple" id="network-fingerprint">WiFi</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== ALERT SYSTEM & SESSION MANAGEMENT ===== -->
        <div class="mt-8">
            <h2 class="font-display text-2xl font-bold mb-6 flex items-center gap-3">
                <svg class="w-7 h-7 text-cyber-warn" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
                Alerts & Sessions
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Custom Alert Rules -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-display text-lg font-semibold">Alert Rules</h3>
                        <button onclick="openAlertRuleModal()" class="px-3 py-1.5 text-xs bg-cyber-warn/20 text-cyber-warn border border-cyber-warn/30 rounded-lg hover:bg-cyber-warn/30 transition-colors">+ New</button>
                    </div>
                    <div id="alert-rules-list" class="space-y-3 max-h-48 overflow-y-auto">
                        <div class="alert-rule alert-rule-inactive p-3 rounded-lg bg-cyber-darker">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium">Night Activity</p>
                                    <p class="text-xs text-gray-500">2:00 AM - 4:00 AM</p>
                                </div>
                                <button onclick="toggleAlertRule(0)" class="px-2 py-1 text-xs bg-gray-700 rounded">Off</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Webhook Configuration -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4">Webhooks</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Discord</label>
                            <input type="url" id="discord-webhook" placeholder="https://discord.com/api/webhooks/..." class="w-full px-3 py-2 text-sm bg-cyber-darker border border-cyber-border rounded-lg focus:border-cyber-purple focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Telegram Token</label>
                            <input type="text" id="telegram-token" placeholder="Bot Token" class="w-full px-3 py-2 text-sm bg-cyber-darker border border-cyber-border rounded-lg focus:border-cyber-info focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Telegram Chat ID</label>
                            <input type="text" id="telegram-chat-id" placeholder="Chat ID" class="w-full px-3 py-2 text-sm bg-cyber-darker border border-cyber-border rounded-lg focus:border-cyber-info focus:outline-none">
                        </div>
                        <button onclick="saveWebhookSettings()" class="w-full py-2 text-sm bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30 rounded-lg hover:bg-cyber-glow/30 transition-colors">Save Webhooks</button>
                    </div>
                </div>
                
                <!-- Session Management -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-display text-lg font-semibold">Sessions</h3>
                        <button onclick="saveCurrentSession()" class="px-3 py-1.5 text-xs bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30 rounded-lg hover:bg-cyber-glow/30 transition-colors">Save</button>
                    </div>
                    <div id="saved-sessions-list" class="space-y-2 max-h-32 overflow-y-auto mb-4">
                        <div class="text-gray-500 text-center py-4 text-sm">No saved sessions</div>
                    </div>
                    <textarea id="session-notes" placeholder="Session notes..." class="w-full h-20 px-3 py-2 text-sm bg-cyber-darker border border-cyber-border rounded-lg resize-none focus:border-cyber-glow focus:outline-none"></textarea>
                    <div class="flex gap-2 mt-3">
                        <button onclick="addSessionTag('important')" class="session-tag tag-important">📌 Important</button>
                        <button onclick="addSessionTag('sleep')" class="session-tag tag-sleep">😴 Sleep</button>
                        <button onclick="addSessionTag('travel')" class="session-tag tag-travel">✈️ Travel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== DATA MANAGEMENT & AUDIT ===== -->
        <div class="mt-8 mb-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Data Management -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <h3 class="font-display text-lg font-semibold mb-4">Data Management</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs text-gray-500 mb-2">Data Retention</label>
                            <select id="data-retention" class="w-full px-3 py-2 text-sm bg-cyber-darker border border-cyber-border rounded-lg focus:border-cyber-glow focus:outline-none">
                                <option value="0">Never delete</option>
                                <option value="7">7 Days</option>
                                <option value="30" selected>30 Days</option>
                                <option value="90">90 Days</option>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="exportAllData()" class="flex-1 py-2 text-xs bg-cyber-info/20 text-cyber-info border border-cyber-info/30 rounded-lg hover:bg-cyber-info/30 transition-colors">Backup</button>
                            <button onclick="importData()" class="flex-1 py-2 text-xs bg-cyber-purple/20 text-cyber-purple border border-cyber-purple/30 rounded-lg hover:bg-cyber-purple/30 transition-colors">Restore</button>
                            <button onclick="clearAllData()" class="flex-1 py-2 text-xs bg-cyber-danger/20 text-cyber-danger border border-cyber-danger/30 rounded-lg hover:bg-cyber-danger/30 transition-colors">Clear</button>
                        </div>
                        <input type="file" id="import-file-input" accept=".json" class="hidden" onchange="handleImportFile(event)">
                    </div>
                </div>
                
                <!-- Audit Log -->
                <div class="bg-cyber-card rounded-2xl border border-cyber-border p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-display text-lg font-semibold">Audit Log</h3>
                        <button onclick="exportAuditLog()" class="px-3 py-1.5 text-xs bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors">Export</button>
                    </div>
                    <div id="audit-log" class="space-y-2 max-h-48 overflow-y-auto font-mono text-xs">
                        <div class="text-gray-500 text-center py-4">Audit log records all activities</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-6" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="bg-cyber-card rounded-2xl border border-cyber-border max-w-md w-full p-6 relative">
            <button onclick="toggleSettings()" class="absolute top-4 right-4 text-gray-400 hover:text-white" aria-label="Close settings">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            
            <h2 id="settings-title" class="font-display text-xl font-semibold mb-6">Settings</h2>
            
            <div class="space-y-4">
                <div>
                    <label for="probe-interval" class="block text-sm text-gray-400 mb-2">Probe Interval (ms)</label>
                    <input type="number" id="probe-interval" value="5000" min="1000" max="60000" class="w-full px-4 py-3 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono focus:border-cyber-glow focus:outline-none">
                    <p class="text-xs text-gray-500 mt-1">Research suggests 1Hz (1000ms) for best results</p>
                </div>
                
                <div>
                    <label for="timeout-value" class="block text-sm text-gray-400 mb-2">Timeout (ms)</label>
                    <input type="number" id="timeout-value" value="5000" min="2000" max="30000" class="w-full px-4 py-3 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono focus:border-cyber-glow focus:outline-none">
                </div>
                
                <div>
                    <label for="backend-url" class="block text-sm text-gray-400 mb-2">Backend URL</label>
                    <input type="text" id="backend-url" value="http://localhost:3001" class="w-full px-4 py-3 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono focus:border-cyber-glow focus:outline-none">
                </div>
                
                <div>
                    <label for="screen-threshold" class="block text-sm text-gray-400 mb-2">Screen On Threshold (ms)</label>
                    <input type="number" id="screen-threshold" value="1000" min="500" max="3000" class="w-full px-4 py-3 bg-cyber-darker border border-cyber-border rounded-xl text-white font-mono focus:border-cyber-glow focus:outline-none">
                    <p class="text-xs text-gray-500 mt-1">RTT below this = Screen On (research: ~1000ms)</p>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded-xl bg-cyber-darker border border-cyber-border">
                    <span class="text-sm">Enable Notifications</span>
                    <button onclick="toggleNotifications()" id="notifications-toggle" class="relative w-12 h-6 rounded-full bg-gray-700 transition-colors" role="switch" aria-checked="false">
                        <div class="absolute top-1 left-1 w-4 h-4 rounded-full bg-white transition-transform"></div>
                    </button>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded-xl bg-cyber-darker border border-cyber-border">
                    <div>
                        <span class="text-sm">Sound Alerts</span>
                        <p class="text-xs text-gray-500">Play sound on status changes</p>
                    </div>
                    <button onclick="toggleSoundAlerts()" id="sound-alerts-toggle" class="relative w-12 h-6 rounded-full bg-gray-700 transition-colors" role="switch" aria-checked="false">
                        <div class="absolute top-1 left-1 w-4 h-4 rounded-full bg-white transition-transform"></div>
                    </button>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded-xl bg-cyber-darker border border-cyber-border">
                    <span class="text-sm">Dark Mode</span>
                    <button class="relative w-12 h-6 rounded-full bg-cyber-glow transition-colors" role="switch" aria-checked="true" disabled>
                        <div class="absolute top-1 right-1 w-4 h-4 rounded-full bg-white"></div>
                    </button>
                </div>
            </div>
            
            <button onclick="saveSettings()" class="w-full mt-6 py-3 bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30 rounded-xl font-medium hover:bg-cyber-glow/30 transition-colors">
                Save Settings
            </button>
        </div>
    </div>
    
    <!-- Help Modal (Keyboard Shortcuts) -->
    <div id="help-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-6" role="dialog" aria-modal="true" aria-labelledby="help-title">
        <div class="bg-cyber-card rounded-2xl border border-cyber-border max-w-md w-full p-6 relative">
            <button onclick="toggleHelp()" class="absolute top-4 right-4 text-gray-400 hover:text-white" aria-label="Close help">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            
            <h2 id="help-title" class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                <svg class="w-5 h-5 text-cyber-info" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Keyboard Shortcuts
            </h2>
            
            <div class="space-y-3">
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Open Settings</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + ,</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Save Settings</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + S</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Close Modal</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Esc</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Show Help</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">?</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Export Data</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + E</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Clear History</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + L</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Toggle Privacy Mode</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + P</kbd>
                </div>
                <div class="flex items-center justify-between p-3 rounded-lg bg-cyber-darker">
                    <span class="text-sm text-gray-300">Print Report</span>
                    <kbd class="px-2 py-1 text-xs bg-cyber-border rounded font-mono">Ctrl + Shift + P</kbd>
                </div>
            </div>
            
            <div class="mt-6 p-4 rounded-xl bg-cyber-info/10 border border-cyber-info/20">
                <h3 class="text-sm font-semibold text-cyber-info mb-2">About RTT Analysis</h3>
                <p class="text-xs text-gray-400">
                    Based on "Careless Whisper" research: RTT values below ~1000ms typically indicate the device screen is ON (active state), 
                    while values above indicate standby or offline states. Multi-device setups generate independent receipts per device.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="border-t border-cyber-border/50 mt-12 py-8 text-center" role="contentinfo">
        <div class="max-w-4xl mx-auto px-6">
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                <img src="https://res.cloudinary.com/dkj22lm1g/image/upload/w_80,h_80,c_fill,q_auto,f_auto/v1768133460/Falcon_Tracker_cbgj3k.jpg" alt="Falcon Tracker Logo" class="w-10 h-10 rounded-lg object-cover" width="40" height="40" loading="lazy">
                <div>
                    <h3 class="font-display text-lg font-semibold text-white">Falcon Tracker</h3>
                    <p class="text-xs text-gray-500">RTT Analysis Dashboard for Delivery Receipt Monitoring</p>
                </div>
            </div>
            
            <div class="p-4 rounded-xl bg-cyber-card/50 border border-cyber-border mb-6">
                <p class="text-xs text-gray-400 mb-2">
                    <strong>Research Attribution:</strong> Based on "Careless Whisper: Exploiting Silent Delivery Receipts to Monitor Users on Mobile Instant Messengers"
                </p>
                <p class="text-xs text-gray-500">
                    Gabriel K. Gegenhuber, Maximilian Günther, Markus Maier, Aljosha Judmayer, Florian Holzbauer, Philipp É. Frenzel, Johanna Ullrich
                </p>
                <p class="text-xs text-gray-500 mt-1">
                    University of Vienna, Faculty of Computer Science & SBA Research | <a href="https://arxiv.org/abs/2411.11194" target="_blank" rel="noopener noreferrer" class="text-cyber-info hover:text-cyber-glow transition-colors">arXiv:2411.11194</a>
                </p>
            </div>
            
            <div class="flex flex-wrap items-center justify-center gap-4 text-xs text-gray-500">
                <span>⚠️ Educational & Research Purposes Only</span>
                <span class="hidden sm:inline">|</span>
                <a href="https://github.com/Falcon-Tracker/Falcon-Tracker.github.io" target="_blank" rel="noopener noreferrer" class="hover:text-cyber-glow transition-colors flex items-center gap-1">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub Repository
                </a>
            </div>
            
            <p class="text-xs text-gray-600 mt-4">
                © 2024 Falcon Tracker. Never track individuals without their explicit consent.
            </p>
        </div>
    </footer>

    <script>
        // ===== STATE MANAGEMENT =====
        const state = {
            platform: 'whatsapp',
            isConnected: false,
            isTracking: false,
            targetNumber: '',
            probeMethod: 'delete',
            rttHistory: [],
            activityData: Array(48).fill(null),
            detectedDevices: [],
            recentTargets: [],
            privacyMode: false,
            lastStatus: null,
            stats: {
                online: 0,
                standby: 0,
                offline: 0,
                total: 0
            },
            settings: {
                probeInterval: 5000,
                timeout: 5000,
                backendUrl: 'http://localhost:3001',
                notifications: false,
                soundAlerts: false,
                screenThreshold: 1000,
                pinLock: false,
                pin: '',
                autoLockTimer: 5,
                auditLogging: true
            },
            // Multi-target tracking
            multiTargets: [],
            // Alert rules
            alertRules: [
                { id: 0, name: 'Night Activity', condition: 'time-window', timeStart: '02:00', timeEnd: '04:00', enabled: false }
            ],
            // Webhook settings
            webhooks: { discord: '', telegramToken: '', telegramChatId: '', custom: '' },
            // Saved sessions
            savedSessions: [],
            // Analytics data
            analytics: {
                heatmapData: {},
                sleepPattern: { start: null, end: null },
                peakHours: Array(24).fill(0)
            },
            // Audit log
            auditLog: [],
            // Bookmarked events
            bookmarkedEvents: [],
            // Session tags
            sessionTags: [],
            // Dashboard profiles
            dashboardProfiles: [],
            // UI state
            ui: {
                fullscreen: false,
                stealthMode: false,
                highContrast: false,
                reducedMotion: false,
                fontSize: 'normal',
                isLocked: false,
                disclaimerAccepted: false
            }
        };

        let rttChart = null;
        let trackingInterval = null;
        let audioContext = null;

        // ===== HELPER FUNCTIONS =====
        /**
         * Calculate the median of a sorted array of numbers
         * @param {number[]} sortedArr - Pre-sorted array of numbers
         * @returns {number} The median value
         */
        function calculateMedian(sortedArr) {
            if (sortedArr.length === 0) return 0;
            const mid = Math.floor(sortedArr.length / 2);
            return sortedArr.length % 2 === 0
                ? Math.round((sortedArr[mid - 1] + sortedArr[mid]) / 2)
                : sortedArr[mid];
        }
        
        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
                error: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',
                warning: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
                info: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
            };
            
            toast.innerHTML = `${icons[type] || icons.info}<span>${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // ===== INPUT VALIDATION =====
        function validatePhoneNumber() {
            const input = document.getElementById('phone-number');
            const icon = document.getElementById('phone-validation-icon');
            const msg = document.getElementById('phone-validation-msg');
            const value = input.value.replace(/\D/g, '');
            
            // Phone number should be between 7 and 15 digits
            const isValid = value.length >= 7 && value.length <= 15;
            
            if (value.length === 0) {
                input.classList.remove('input-valid', 'input-invalid');
                icon.classList.add('hidden');
                msg.textContent = 'Format: Country code + number (e.g., +1 7012345678)';
                msg.className = 'text-xs text-gray-500 font-mono';
            } else if (isValid) {
                input.classList.remove('input-invalid');
                input.classList.add('input-valid');
                icon.innerHTML = '<svg class="w-5 h-5 text-cyber-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                icon.classList.remove('hidden');
                msg.textContent = 'Valid phone number format';
                msg.className = 'text-xs text-cyber-glow font-mono';
            } else {
                input.classList.remove('input-valid');
                input.classList.add('input-invalid');
                icon.innerHTML = '<svg class="w-5 h-5 text-cyber-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                icon.classList.remove('hidden');
                msg.textContent = value.length < 7 ? 'Phone number too short (min 7 digits)' : 'Phone number too long (max 15 digits)';
                msg.className = 'text-xs text-cyber-danger font-mono';
            }
            
            return isValid;
        }
        
        function validateCountryCode() {
            const input = document.getElementById('country-code');
            let value = input.value;
            
            // Ensure it starts with +
            if (!value.startsWith('+')) {
                value = '+' + value.replace(/[^0-9]/g, '');
            } else {
                value = '+' + value.slice(1).replace(/[^0-9]/g, '');
            }
            
            // Limit to 4 characters (+ and up to 3 digits)
            if (value.length > 4) {
                value = value.slice(0, 4);
            }
            
            input.value = value;
        }
        
        // ===== RECENT TARGETS =====
        function loadRecentTargets() {
            const saved = localStorage.getItem('falcon-tracker-recent-targets');
            if (saved) {
                state.recentTargets = JSON.parse(saved);
            }
        }
        
        function saveRecentTarget(countryCode, phoneNumber) {
            const fullNumber = countryCode + phoneNumber;
            
            // Remove if already exists
            state.recentTargets = state.recentTargets.filter(t => t.full !== fullNumber);
            
            // Add to beginning
            state.recentTargets.unshift({
                countryCode: countryCode,
                phone: phoneNumber,
                full: fullNumber,
                platform: state.platform,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 10
            if (state.recentTargets.length > 10) {
                state.recentTargets = state.recentTargets.slice(0, 10);
            }
            
            localStorage.setItem('falcon-tracker-recent-targets', JSON.stringify(state.recentTargets));
        }
        
        function showRecentTargets() {
            if (state.recentTargets.length === 0) return;
            
            const dropdown = document.getElementById('recent-targets-dropdown');
            const list = document.getElementById('recent-targets-list');
            
            // Clear existing content
            list.innerHTML = '';
            
            // Create elements safely to prevent XSS
            state.recentTargets.forEach(target => {
                const item = document.createElement('div');
                item.className = 'recent-target-item';
                item.onclick = () => selectRecentTarget(target.countryCode, target.phone);
                
                const infoDiv = document.createElement('div');
                const phoneSpan = document.createElement('span');
                phoneSpan.className = 'font-mono text-sm';
                phoneSpan.textContent = '+' + target.full;
                
                const platformSpan = document.createElement('span');
                platformSpan.className = 'text-xs text-gray-500 ml-2';
                platformSpan.textContent = target.platform;
                
                infoDiv.appendChild(phoneSpan);
                infoDiv.appendChild(platformSpan);
                
                const dateSpan = document.createElement('span');
                dateSpan.className = 'text-xs text-gray-500';
                dateSpan.textContent = new Date(target.timestamp).toLocaleDateString();
                
                item.appendChild(infoDiv);
                item.appendChild(dateSpan);
                list.appendChild(item);
            });
            
            dropdown.classList.remove('hidden');
        }
        
        function hideRecentTargets() {
            setTimeout(() => {
                document.getElementById('recent-targets-dropdown').classList.add('hidden');
            }, 200);
        }
        
        function toggleRecentTargets() {
            const dropdown = document.getElementById('recent-targets-dropdown');
            if (dropdown.classList.contains('hidden')) {
                showRecentTargets();
            } else {
                dropdown.classList.add('hidden');
            }
        }
        
        function selectRecentTarget(countryCode, phone) {
            // countryCode is stored without the + prefix
            document.getElementById('country-code').value = '+' + countryCode;
            document.getElementById('phone-number').value = phone;
            document.getElementById('recent-targets-dropdown').classList.add('hidden');
            validatePhoneNumber();
        }
        
        function clearRecentTargets() {
            state.recentTargets = [];
            localStorage.removeItem('falcon-tracker-recent-targets');
            document.getElementById('recent-targets-dropdown').classList.add('hidden');
            showToast('Recent targets cleared', 'info');
        }
        
        // ===== PRIVACY MODE =====
        function togglePrivacyMode() {
            state.privacyMode = !state.privacyMode;
            
            const icon = document.getElementById('privacy-icon');
            const toggle = document.getElementById('privacy-toggle');
            const privacyTargets = document.querySelectorAll('.privacy-target, #phone-number, #status-jid');
            
            if (state.privacyMode) {
                toggle.classList.add('border-cyber-purple');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                `;
                privacyTargets.forEach(el => el.classList.add('privacy-blur'));
                showToast('Privacy mode enabled', 'info');
            } else {
                toggle.classList.remove('border-cyber-purple');
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                `;
                privacyTargets.forEach(el => el.classList.remove('privacy-blur'));
                showToast('Privacy mode disabled', 'info');
            }
        }
        
        // ===== SOUND ALERTS =====
        function initAudioContext() {
            if (!audioContext) {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (!AudioContextClass) {
                    console.warn('AudioContext not supported in this browser');
                    return null;
                }
                try {
                    audioContext = new AudioContextClass();
                } catch (err) {
                    console.warn('Failed to create AudioContext:', err.message);
                    return null;
                }
            }
            return audioContext;
        }
        
        function playStatusSound(status) {
            if (!state.settings.soundAlerts) return;
            
            try {
                const ctx = initAudioContext();
                if (!ctx) return; // AudioContext not available
                
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                // Different frequencies for different statuses
                const frequencies = {
                    online: 880,   // High pitch - good
                    standby: 440,  // Medium pitch - neutral  
                    offline: 220   // Low pitch - warning
                };
                
                oscillator.frequency.value = frequencies[status] || 440;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.3);
            } catch (err) {
                // Audio playback failed - could be user gesture required or blocked
                console.warn('Sound alert failed:', err.message);
            }
        }
        
        function toggleSoundAlerts() {
            state.settings.soundAlerts = !state.settings.soundAlerts;
            const toggle = document.getElementById('sound-alerts-toggle');
            const dot = toggle.querySelector('div');
            
            if (state.settings.soundAlerts) {
                toggle.className = 'relative w-12 h-6 rounded-full bg-cyber-glow transition-colors';
                toggle.setAttribute('aria-checked', 'true');
                dot.className = 'absolute top-1 right-1 w-4 h-4 rounded-full bg-white transition-transform';
                playStatusSound('online'); // Test sound
                showToast('Sound alerts enabled', 'success');
            } else {
                toggle.className = 'relative w-12 h-6 rounded-full bg-gray-700 transition-colors';
                toggle.setAttribute('aria-checked', 'false');
                dot.className = 'absolute top-1 left-1 w-4 h-4 rounded-full bg-white transition-transform';
                showToast('Sound alerts disabled', 'info');
            }
        }
        
        // ===== NETWORK QUALITY INDICATOR =====
        function updateNetworkQuality() {
            // Simulate network quality based on RTT history
            const indicator = document.getElementById('network-indicator');
            const qualityText = document.getElementById('network-quality');
            const icon = indicator.querySelector('svg');
            
            let quality = 'Excellent';
            let colorClass = 'network-excellent';
            
            if (state.rttHistory.length > 0) {
                const recentRtts = state.rttHistory.slice(-5).map(h => h.rtt);
                const avgRtt = recentRtts.reduce((a, b) => a + b, 0) / recentRtts.length;
                
                if (avgRtt < 500) {
                    quality = 'Excellent';
                    colorClass = 'network-excellent';
                } else if (avgRtt < 1000) {
                    quality = 'Good';
                    colorClass = 'network-good';
                } else if (avgRtt < 2000) {
                    quality = 'Fair';
                    colorClass = 'network-fair';
                } else {
                    quality = 'Poor';
                    colorClass = 'network-poor';
                }
            }
            
            icon.className = `w-4 h-4 ${colorClass}`;
            qualityText.textContent = quality;
        }
        
        // ===== PRINT REPORT =====
        function printReport() {
            if (state.rttHistory.length === 0) {
                showToast('No data to print. Start tracking first.', 'warning');
                return;
            }
            
            const reportWindow = window.open('', '_blank');
            const platformName = state.platform.charAt(0).toUpperCase() + state.platform.slice(1);
            
            const reportContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Falcon Tracker Report - ${new Date().toLocaleDateString()}</title>
                    <style>
                        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                        h1 { color: #00ff88; border-bottom: 2px solid #00ff88; padding-bottom: 10px; }
                        h2 { color: #666; margin-top: 30px; }
                        .meta { color: #888; font-size: 14px; margin-bottom: 20px; }
                        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
                        .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; text-align: center; }
                        .stat-value { font-size: 28px; font-weight: bold; }
                        .stat-label { font-size: 12px; color: #666; text-transform: uppercase; }
                        .online { color: #00ff88; }
                        .standby { color: #ffb800; }
                        .offline { color: #ff3366; }
                        .info { color: #00b4ff; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background: #f0f0f0; }
                        .footer { margin-top: 40px; text-align: center; color: #999; font-size: 12px; }
                        @media print { body { padding: 20px; } }
                    </style>
                </head>
                <body>
                    <h1>🦅 Falcon Tracker Report</h1>
                    <div class="meta">
                        <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                        <p><strong>Platform:</strong> ${platformName}</p>
                        <p><strong>Target:</strong> +${state.targetNumber || 'N/A'}</p>
                        <p><strong>Session Duration:</strong> ${state.rttHistory.length} probes</p>
                    </div>
                    
                    <h2>Session Statistics</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value online">${state.stats.online}</div>
                            <div class="stat-label">Online</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value standby">${state.stats.standby}</div>
                            <div class="stat-label">Standby</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value offline">${state.stats.offline}</div>
                            <div class="stat-label">Offline</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value info">${state.stats.total}</div>
                            <div class="stat-label">Total</div>
                        </div>
                    </div>
                    
                    <h2>RTT Data (Last 50 entries)</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>RTT (ms)</th>
                                <th>Status</th>
                                <th>Screen</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.rttHistory.slice(-50).reverse().map(h => `
                                <tr>
                                    <td>${new Date(h.timestamp).toLocaleTimeString()}</td>
                                    <td>${h.rtt}</td>
                                    <td class="${h.status}">${h.status.charAt(0).toUpperCase() + h.status.slice(1)}</td>
                                    <td>${h.screenState === 'on' ? 'ON' : h.screenState === 'off' ? 'OFF' : 'Unknown'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>Generated by Falcon Tracker | Based on "Careless Whisper" Research</p>
                        <p>⚠️ For educational and research purposes only</p>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportContent);
            reportWindow.document.close();
            reportWindow.print();
            
            showToast('Report generated successfully', 'success');
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            initActivityTimeline();
            initProbeMethodListeners();
            loadSettings();
            loadRecentTargets();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#recent-targets-dropdown') && !e.target.closest('#phone-number') && !e.target.closest('#recent-targets-btn')) {
                    document.getElementById('recent-targets-dropdown').classList.add('hidden');
                }
            });
            
            // Simulate connection for demo
            setTimeout(() => simulateConnection(), 1000);
        });

        // ===== CHART INITIALIZATION =====
        function initChart() {
            const ctx = document.getElementById('rtt-chart').getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 256);
            gradient.addColorStop(0, 'rgba(0, 255, 136, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 255, 136, 0)');
            
            rttChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'RTT (ms)',
                        data: [],
                        borderColor: '#00ff88',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#00ff88',
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 2,
                        borderWidth: 2
                    }, {
                        label: 'Threshold',
                        data: [],
                        borderColor: '#ffb800',
                        borderDash: [5, 5],
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#12121a',
                            borderColor: '#1f1f2e',
                            borderWidth: 1,
                            padding: 12,
                            titleFont: {
                                family: 'JetBrains Mono',
                                size: 12
                            },
                            bodyFont: {
                                family: 'JetBrains Mono',
                                size: 11
                            },
                            displayColors: true,
                            callbacks: {
                                title: (items) => items[0]?.label || '',
                                label: (item) => ` ${item.dataset.label}: ${item.raw}ms`
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                color: 'rgba(31, 31, 46, 0.5)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    family: 'JetBrains Mono',
                                    size: 10
                                },
                                maxRotation: 0,
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            display: true,
                            grid: {
                                color: 'rgba(31, 31, 46, 0.5)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    family: 'JetBrains Mono',
                                    size: 10
                                },
                                callback: (value) => value + 'ms'
                            },
                            suggestedMin: 0
                        }
                    }
                }
            });
        }

        // ===== ACTIVITY TIMELINE =====
        function initActivityTimeline() {
            const container = document.getElementById('activity-timeline');
            container.innerHTML = '';
            
            for (let i = 0; i < 48; i++) {
                const bar = document.createElement('div');
                bar.className = 'activity-bar flex-1 rounded-t bg-gray-700/50 cursor-pointer';
                bar.style.height = '10%';
                // Pad hour and minute with leading zeros for consistent display
                const hour = Math.floor(i / 2).toString().padStart(2, '0');
                const min = ((i % 2) * 30).toString().padStart(2, '0');
                bar.title = `${hour}:${min} - No data`;
                container.appendChild(bar);
            }
        }

        function updateActivityTimeline(data) {
            const bars = document.querySelectorAll('.activity-bar');
            data.forEach((activity, index) => {
                if (activity && bars[index]) {
                    const bar = bars[index];
                    const height = Math.max(10, Math.min(100, activity.intensity));
                    bar.style.height = `${height}%`;
                    
                    if (activity.status === 'online') {
                        bar.className = 'activity-bar flex-1 rounded-t bg-cyber-glow cursor-pointer';
                    } else if (activity.status === 'standby') {
                        bar.className = 'activity-bar flex-1 rounded-t bg-cyber-warn cursor-pointer';
                    } else {
                        bar.className = 'activity-bar flex-1 rounded-t bg-cyber-danger cursor-pointer';
                    }
                    
                    const hour = Math.floor(index / 2);
                    const min = (index % 2) * 30;
                    // Pad hour and minute with leading zeros for consistent display
                    const hourStr = hour.toString().padStart(2, '0');
                    const minStr = min.toString().padStart(2, '0');
                    bar.title = `${hourStr}:${minStr} - ${activity.status.charAt(0).toUpperCase() + activity.status.slice(1)} (${activity.rtt}ms)`;
                }
            });
        }

        // ===== PROBE METHOD =====
        function initProbeMethodListeners() {
            document.querySelectorAll('.probe-option').forEach(option => {
                option.addEventListener('click', () => {
                    const method = option.dataset.method;
                    state.probeMethod = method;
                    
                    document.querySelectorAll('.probe-option').forEach(opt => {
                        const radio = opt.querySelector('input[type="radio"]');
                        const dot = opt.querySelector('.rounded-full');
                        const innerDot = dot.querySelector('div');
                        
                        if (opt.dataset.method === method) {
                            radio.checked = true;
                            dot.classList.remove('border-gray-600');
                            dot.classList.add('border-cyber-glow');
                            innerDot.classList.remove('bg-transparent');
                            innerDot.classList.add('bg-cyber-glow');
                        } else {
                            radio.checked = false;
                            dot.classList.add('border-gray-600');
                            dot.classList.remove('border-cyber-glow');
                            innerDot.classList.add('bg-transparent');
                            innerDot.classList.remove('bg-cyber-glow');
                        }
                    });
                    
                    addLog('info', `Probe method changed to: ${method === 'delete' ? 'Silent Delete' : method === 'reaction' ? 'Self-Reaction' : 'Message Edit'}`);
                });
            });
        }

        // ===== PLATFORM SELECTION =====
        function selectPlatform(platform) {
            state.platform = platform;
            
            const waBtn = document.getElementById('btn-whatsapp');
            const sigBtn = document.getElementById('btn-signal');
            const threeBtn = document.getElementById('btn-threema');
            const platformLabel = document.getElementById('current-platform');
            
            // Reset all buttons
            const resetClass = 'platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 text-gray-400 hover:text-white';
            waBtn.className = resetClass;
            sigBtn.className = resetClass;
            threeBtn.className = resetClass;
            waBtn.setAttribute('aria-selected', 'false');
            sigBtn.setAttribute('aria-selected', 'false');
            threeBtn.setAttribute('aria-selected', 'false');
            
            // Set active platform
            if (platform === 'whatsapp') {
                waBtn.className = 'platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 bg-cyber-glow/20 text-cyber-glow border border-cyber-glow/30';
                waBtn.setAttribute('aria-selected', 'true');
                platformLabel.textContent = 'WhatsApp';
                platformLabel.className = 'text-cyber-glow';
            } else if (platform === 'signal') {
                sigBtn.className = 'platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 bg-cyber-info/20 text-cyber-info border border-cyber-info/30';
                sigBtn.setAttribute('aria-selected', 'true');
                platformLabel.textContent = 'Signal';
                platformLabel.className = 'text-cyber-info';
            } else if (platform === 'threema') {
                threeBtn.className = 'platform-btn px-4 sm:px-6 py-2.5 rounded-lg font-medium transition-all duration-300 flex items-center gap-2 bg-cyber-purple/20 text-cyber-purple border border-cyber-purple/30';
                threeBtn.setAttribute('aria-selected', 'true');
                platformLabel.textContent = 'Threema';
                platformLabel.className = 'text-cyber-purple';
            }
            
            addLog('info', `Platform switched to ${platform.charAt(0).toUpperCase() + platform.slice(1)}`);
            
            // Show Threema limitation warning
            if (platform === 'threema') {
                addLog('warn', 'Note: Threema has limited covert probing capabilities (no silent reactions)');
            }
        }

        // ===== QR CODE =====
        function generateQR() {
            const placeholder = document.getElementById('qr-placeholder');
            const platformName = state.platform.charAt(0).toUpperCase() + state.platform.slice(1);
            
            placeholder.innerHTML = `
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-cyber-glow flex items-center justify-center animate-pulse">
                        <svg class="w-8 h-8 text-cyber-dark animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    <p class="text-gray-800 text-sm font-medium">Generating QR for ${platformName}...</p>
                </div>
            `;
            
            setTimeout(() => {
                // Simulate QR code generation with a pattern
                placeholder.innerHTML = `
                    <div class="w-full h-full bg-white p-2">
                        <svg viewBox="0 0 100 100" class="w-full h-full">
                            ${generateQRPattern()}
                        </svg>
                    </div>
                `;
                
                document.getElementById('auth-status').innerHTML = `
                    <p class="text-sm text-gray-400">Scan with your phone</p>
                    <p class="text-xs text-gray-500 mt-1">Open ${platformName} &gt; Settings &gt; Linked Devices</p>
                `;
                
                addLog('success', `QR code generated for ${platformName}. Waiting for scan...`);
                
                // Simulate successful scan after delay
                setTimeout(() => simulateConnection(), 3000);
            }, 1500);
        }

        function generateQRPattern() {
            let pattern = '';
            const size = 20;
            const cellSize = 100 / size;
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    // Create a pseudo-random but deterministic pattern
                    const isBlack = (
                        (i < 3 && j < 3) || 
                        (i < 3 && j > size - 4) || 
                        (i > size - 4 && j < 3) ||
                        Math.sin(i * 7 + j * 11) > 0.2
                    );
                    
                    if (isBlack) {
                        pattern += `<rect x="${j * cellSize}" y="${i * cellSize}" width="${cellSize}" height="${cellSize}" fill="#000"/>`;
                    }
                }
            }
            
            return pattern;
        }

        // ===== CONNECTION SIMULATION =====
        function simulateConnection() {
            state.isConnected = true;
            
            document.getElementById('status-dot').className = 'w-2 h-2 rounded-full bg-cyber-glow animate-pulse';
            document.getElementById('status-text').textContent = 'Connected';
            document.getElementById('status-text').className = 'text-sm font-mono text-cyber-glow';
            
            document.getElementById('auth-status').innerHTML = `
                <div class="flex items-center justify-center gap-2 text-cyber-glow">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="text-sm font-medium">Authenticated</span>
                </div>
            `;
            
            addLog('success', 'Successfully connected to ' + state.platform.charAt(0).toUpperCase() + state.platform.slice(1));
        }

        // ===== TRACKING =====
        function startTracking() {
            const countryCode = document.getElementById('country-code').value.replace('+', '');
            const phoneNumber = document.getElementById('phone-number').value.replace(/\D/g, '');
            
            // Validate phone number
            if (!phoneNumber || !validatePhoneNumber()) {
                showToast('Please enter a valid phone number', 'error');
                addLog('error', 'Please enter a valid phone number');
                return;
            }
            
            if (!state.isConnected) {
                showToast('Please connect first by scanning the QR code', 'warning');
                addLog('error', 'Please connect first by scanning the QR code');
                return;
            }
            
            state.targetNumber = countryCode + phoneNumber;
            state.isTracking = true;
            
            // Save to recent targets
            saveRecentTarget(countryCode, phoneNumber);
            
            const btn = document.getElementById('start-tracking-btn');
            btn.innerHTML = `
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Tracking...
            `;
            btn.classList.add('bg-cyber-danger/20', 'border-cyber-danger/30');
            btn.classList.remove('from-cyber-glow/20', 'to-cyber-purple/20', 'border-cyber-glow/30');
            btn.onclick = stopTracking;
            
            // Set JID based on platform
            const jidSuffix = state.platform === 'whatsapp' ? '@s.whatsapp.net' 
                : state.platform === 'signal' ? '@signal' 
                : '@threema.ch';
            document.getElementById('status-jid').textContent = `${state.targetNumber}${jidSuffix}`;
            
            showToast(`Tracking started for +${state.targetNumber}`, 'success');
            addLog('info', `Started tracking: +${state.targetNumber} on ${state.platform.charAt(0).toUpperCase() + state.platform.slice(1)}`);
            addLog('info', `Probe method: ${state.probeMethod === 'delete' ? 'Silent Delete' : state.probeMethod === 'reaction' ? 'Self-Reaction' : 'Message Edit'}`);
            
            // Start simulating data
            simulateTracking();
            trackingInterval = setInterval(simulateTracking, state.settings.probeInterval);
        }

        function stopTracking() {
            state.isTracking = false;
            
            if (trackingInterval) {
                clearInterval(trackingInterval);
                trackingInterval = null;
            }
            
            const btn = document.getElementById('start-tracking-btn');
            btn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Start Tracking
            `;
            btn.classList.remove('bg-cyber-danger/20', 'border-cyber-danger/30');
            btn.classList.add('from-cyber-glow/20', 'to-cyber-purple/20', 'border-cyber-glow/30');
            btn.onclick = startTracking;
            
            showToast('Tracking stopped', 'info');
            addLog('info', 'Tracking stopped');
        }

        function simulateTracking() {
            // Use configurable threshold from settings
            const screenThreshold = state.settings.screenThreshold;
            // Standby threshold is 3x the screen threshold (based on research findings)
            const standbyThreshold = screenThreshold * 3;
            
            // Generate realistic RTT values based on research paper findings
            // Simulate different states randomly based on RTT thresholds from research
            const stateRoll = Math.random();
            let rtt;
            let deviceStatus;
            let screenState;
            
            if (stateRoll < 0.4) {
                // Screen ON - fast response (RTT < screenThreshold)
                // Generate RTT between 20% and 80% of threshold
                rtt = Math.round(screenThreshold * 0.2 + Math.random() * screenThreshold * 0.6);
                deviceStatus = 'online';
                screenState = 'on';
            } else if (stateRoll < 0.85) {
                // Screen OFF/Standby - delayed response (screenThreshold <= RTT < standbyThreshold)
                rtt = Math.round(screenThreshold + Math.random() * (standbyThreshold - screenThreshold));
                deviceStatus = 'standby';
                screenState = 'off';
            } else {
                // Offline - timeout (RTT >= standbyThreshold)
                rtt = Math.round(standbyThreshold + Math.random() * 2000);
                deviceStatus = 'offline';
                screenState = 'unknown';
            }
            
            // Determine status based on actual RTT vs thresholds (for accuracy verification)
            // This ensures status matches RTT even if simulation changes
            if (rtt < screenThreshold) {
                deviceStatus = 'online';
                screenState = 'on';
            } else if (rtt < standbyThreshold) {
                deviceStatus = 'standby';
                screenState = 'off';
            } else {
                deviceStatus = 'offline';
                screenState = 'unknown';
            }
            
            // Update state
            state.rttHistory.push({
                rtt: rtt,
                timestamp: new Date(),
                status: deviceStatus,
                screenState: screenState
            });
            
            // Keep history limited
            const timeframe = parseInt(document.getElementById('chart-timeframe').value);
            if (state.rttHistory.length > timeframe) {
                state.rttHistory = state.rttHistory.slice(-timeframe);
            }
            
            // Calculate metrics
            const recentRtts = state.rttHistory.slice(-3).map(h => h.rtt);
            const movingAvg = recentRtts.length > 0 
                ? Math.round(recentRtts.reduce((a, b) => a + b, 0) / recentRtts.length)
                : 0;
            
            const sortedRtts = [...state.rttHistory.map(h => h.rtt)].sort((a, b) => a - b);
            const median = calculateMedian(sortedRtts);
            const threshold = state.settings.screenThreshold;
            
            // Update statistics
            updateStatistics(deviceStatus);
            
            // Update UI
            updateStatusCard(deviceStatus, rtt, screenState);
            updateMetrics(rtt, movingAvg, median, threshold);
            updateChart();
            updateActivityData(deviceStatus, rtt);
            updateOSFingerprint(rtt);
            updateDeviceSessions(deviceStatus);
            updateNetworkQuality();
            
            // Play sound alert if status changed
            if (state.lastStatus !== null && state.lastStatus !== deviceStatus) {
                playStatusSound(deviceStatus);
            }
            state.lastStatus = deviceStatus;
            
            // Log event
            const statusEmoji = deviceStatus === 'online' ? '🟢' : deviceStatus === 'standby' ? '🟡' : '🔴';
            const screenEmoji = screenState === 'on' ? '📱' : screenState === 'off' ? '💤' : '❓';
            addLog(deviceStatus === 'offline' ? 'warn' : 'success', 
                `${statusEmoji} ${deviceStatus.toUpperCase()} | Screen: ${screenEmoji} | RTT: ${rtt}ms | Avg: ${movingAvg}ms`);
        }
        
        // ===== STATISTICS =====
        function updateStatistics(status) {
            state.stats.total++;
            if (status === 'online') state.stats.online++;
            else if (status === 'standby') state.stats.standby++;
            else state.stats.offline++;
            
            document.getElementById('stat-online').textContent = state.stats.online;
            document.getElementById('stat-standby').textContent = state.stats.standby;
            document.getElementById('stat-offline').textContent = state.stats.offline;
            document.getElementById('stat-total').textContent = state.stats.total;
        }
        
        // ===== OS FINGERPRINTING (from research) =====
        function updateOSFingerprint(rtt) {
            // OS fingerprinting based on research findings about distinct timing patterns
            // The detection uses historical RTT data for more accurate fingerprinting
            const osIcon = document.getElementById('os-icon');
            const osName = document.getElementById('os-name');
            
            // Use threshold-relative RTT comparison for consistency
            const screenThreshold = state.settings.screenThreshold;
            const normalizedRtt = rtt / screenThreshold;
            
            // Build confidence based on RTT history consistency
            const recentHistory = state.rttHistory.slice(-10);
            const avgRecentRtt = recentHistory.length > 0
                ? recentHistory.reduce((sum, h) => sum + h.rtt, 0) / recentHistory.length
                : rtt;
            
            // Calculate RTT standard deviation for confidence scoring
            // Using population standard deviation (divide by n) since we're using the full available sample
            const stdDev = recentHistory.length > 1
                ? Math.sqrt(recentHistory.reduce((sum, h) => sum + Math.pow(h.rtt - avgRecentRtt, 2), 0) / recentHistory.length)
                : 0;
            
            // Lower standard deviation = higher confidence (more consistent = easier to fingerprint)
            const baseConfidence = Math.max(50, Math.min(95, 95 - (stdDev / 10)));
            
            let detectedOS = { icon: '❓', name: 'Unknown', confidence: 0 };
            
            // Detection based on normalized RTT patterns (relative to threshold)
            if (normalizedRtt < 0.4) {
                // Very fast responses - typically iOS with push notification optimization
                detectedOS = { 
                    icon: '🍎', 
                    name: 'iOS', 
                    confidence: Math.round(baseConfidence * 0.9)
                };
            } else if (normalizedRtt < 0.7) {
                // Moderate fast responses - typically Android
                detectedOS = { 
                    icon: '🤖', 
                    name: 'Android', 
                    confidence: Math.round(baseConfidence * 0.85)
                };
            } else if (normalizedRtt < 1.0) {
                // Near-threshold responses - could be desktop/web clients
                // Use RTT standard deviation to distinguish
                if (stdDev < 100) {
                    detectedOS = { 
                        icon: '💻', 
                        name: 'Desktop', 
                        confidence: Math.round(baseConfidence * 0.75)
                    };
                } else {
                    detectedOS = { 
                        icon: '🌐', 
                        name: 'Web Client', 
                        confidence: Math.round(baseConfidence * 0.7)
                    };
                }
            } else if (normalizedRtt < 2.0) {
                // Slow responses - device in standby, harder to fingerprint
                detectedOS = { 
                    icon: '📱', 
                    name: 'Mobile (Standby)', 
                    confidence: Math.round(baseConfidence * 0.5)
                };
            }
            // else: Keep as Unknown for very slow/offline responses
            
            osIcon.textContent = detectedOS.icon;
            osName.textContent = detectedOS.confidence > 0 
                ? `${detectedOS.name} (${detectedOS.confidence}%)`
                : detectedOS.name;
        }
        
        // ===== MULTI-DEVICE SESSIONS (from research) =====
        function updateDeviceSessions(status) {
            const container = document.getElementById('device-sessions');
            
            // Simulate multi-device detection (research shows independent receipts per device)
            const devices = [
                { type: 'smartphone', icon: '📱', name: 'Primary Smartphone', platform: state.platform },
                { type: 'desktop', icon: '💻', name: 'Desktop Client', platform: 'web' },
                { type: 'web', icon: '🌐', name: 'Web Browser', platform: 'web' }
            ];
            
            // Randomly simulate device activity
            const activeDevices = devices.filter(() => Math.random() > 0.3);
            
            if (activeDevices.length > 0) {
                container.innerHTML = activeDevices.map((device, idx) => {
                    const isActive = Math.random() > 0.4;
                    const deviceRtt = isActive ? Math.round(200 + Math.random() * 500) : Math.round(1500 + Math.random() * 1000);
                    const statusColor = isActive ? 'bg-cyber-glow' : 'bg-cyber-warn';
                    const statusText = isActive ? 'Active' : 'Standby';
                    
                    return `
                        <div class="p-3 rounded-lg bg-cyber-darker border border-cyber-border flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">${device.icon}</span>
                                <div>
                                    <p class="text-sm font-medium">${device.name}</p>
                                    <p class="text-xs text-gray-500">RTT: ${deviceRtt}ms</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-400">${statusText}</span>
                                <span class="w-2 h-2 rounded-full ${statusColor} animate-pulse"></span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateStatusCard(status, rtt, screenState) {
            const card = document.getElementById('status-card');
            const icon = document.getElementById('status-icon');
            const emoji = document.getElementById('status-emoji');
            const label = document.getElementById('status-label');
            const screenStateEl = document.getElementById('screen-state');
            
            // Update timestamp
            document.getElementById('last-update').textContent = `Last update: ${new Date().toLocaleTimeString()}`;
            
            // Update screen state indicator
            if (screenState === 'on') {
                screenStateEl.textContent = 'ON';
                screenStateEl.className = 'text-xs font-mono px-2 py-0.5 rounded bg-cyber-glow/20 text-cyber-glow';
            } else if (screenState === 'off') {
                screenStateEl.textContent = 'OFF';
                screenStateEl.className = 'text-xs font-mono px-2 py-0.5 rounded bg-cyber-warn/20 text-cyber-warn';
            } else {
                screenStateEl.textContent = 'Unknown';
                screenStateEl.className = 'text-xs font-mono px-2 py-0.5 rounded bg-gray-700 text-gray-400';
            }
            
            if (status === 'online') {
                card.className = 'relative p-6 rounded-xl bg-gradient-to-br from-cyber-glow/20 to-cyber-glow/5 border border-cyber-glow/30 text-center status-online';
                icon.className = 'w-20 h-20 mx-auto mb-4 rounded-full bg-cyber-glow/20 flex items-center justify-center';
                emoji.textContent = '📱';
                label.textContent = 'Screen ON';
                label.className = 'text-2xl font-display font-bold text-cyber-glow';
            } else if (status === 'standby') {
                card.className = 'relative p-6 rounded-xl bg-gradient-to-br from-cyber-warn/20 to-cyber-warn/5 border border-cyber-warn/30 text-center status-standby';
                icon.className = 'w-20 h-20 mx-auto mb-4 rounded-full bg-cyber-warn/20 flex items-center justify-center';
                emoji.textContent = '💤';
                label.textContent = 'Screen OFF';
                label.className = 'text-2xl font-display font-bold text-cyber-warn';
            } else {
                card.className = 'relative p-6 rounded-xl bg-gradient-to-br from-cyber-danger/20 to-cyber-danger/5 border border-cyber-danger/30 text-center status-offline';
                icon.className = 'w-20 h-20 mx-auto mb-4 rounded-full bg-cyber-danger/20 flex items-center justify-center';
                emoji.textContent = '📵';
                label.textContent = 'Offline';
                label.className = 'text-2xl font-display font-bold text-cyber-danger';
            }
        }

        function updateMetrics(rtt, movingAvg, median, threshold) {
            document.getElementById('current-rtt').textContent = rtt;
            document.getElementById('moving-avg').textContent = movingAvg;
            document.getElementById('median-rtt').textContent = median;
            document.getElementById('threshold').textContent = threshold;
        }

        function updateChart() {
            const labels = state.rttHistory.map((h, i) => {
                const time = new Date(h.timestamp);
                return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            });
            
            const rttData = state.rttHistory.map(h => h.rtt);
            
            // Use screen threshold from settings (based on research: ~1000ms for screen on/off)
            const threshold = state.settings.screenThreshold;
            const thresholdData = new Array(rttData.length).fill(threshold);
            
            rttChart.data.labels = labels;
            rttChart.data.datasets[0].data = rttData;
            rttChart.data.datasets[1].data = thresholdData;
            rttChart.update('none');
        }

        function updateActivityData(status, rtt) {
            const now = new Date();
            // Calculate slot index: 48 slots for 24 hours (30-minute intervals)
            // Hours 0-23, minutes 0-29 = first half, 30-59 = second half
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const slotIndex = hours * 2 + (minutes >= 30 ? 1 : 0);
            
            // Calculate intensity based on RTT value relative to thresholds
            // Lower RTT = higher intensity (more active)
            const screenThreshold = state.settings.screenThreshold;
            const standbyThreshold = screenThreshold * 3;
            let intensity;
            
            if (rtt < screenThreshold) {
                // Screen ON: intensity 70-100 based on how fast the response is
                intensity = Math.round(100 - (rtt / screenThreshold) * 30);
            } else if (rtt < standbyThreshold) {
                // Standby: intensity 30-70 based on response time
                const normalizedRtt = (rtt - screenThreshold) / (standbyThreshold - screenThreshold);
                intensity = Math.round(70 - normalizedRtt * 40);
            } else {
                // Offline: intensity 10-30
                intensity = Math.max(10, Math.round(30 - Math.min(rtt - standbyThreshold, 2000) / 100));
            }
            
            state.activityData[slotIndex] = {
                status: status,
                rtt: rtt,
                intensity: Math.min(100, Math.max(10, intensity))
            };
            
            updateActivityTimeline(state.activityData);
        }

        // ===== LOGGING =====
        function addLog(type, message) {
            const log = document.getElementById('event-log');
            const time = new Date().toLocaleTimeString();
            
            const typeColors = {
                'success': 'text-cyber-glow',
                'info': 'text-cyber-info',
                'warn': 'text-cyber-warn',
                'error': 'text-cyber-danger'
            };
            
            const entry = document.createElement('div');
            entry.className = `flex items-start gap-3 p-2 rounded-lg hover:bg-cyber-darker/50 transition-colors`;
            entry.innerHTML = `
                <span class="text-gray-500 text-xs whitespace-nowrap">${time}</span>
                <span class="${typeColors[type] || 'text-gray-400'}">${message}</span>
            `;
            
            // Remove placeholder if exists
            const placeholder = log.querySelector('.text-gray-500.text-center');
            if (placeholder) {
                placeholder.remove();
            }
            
            log.insertBefore(entry, log.firstChild);
            
            // Keep log limited
            while (log.children.length > 100) {
                log.removeChild(log.lastChild);
            }
        }

        function clearLogs() {
            const log = document.getElementById('event-log');
            log.innerHTML = '<div class="text-gray-500 text-center py-8">Log cleared</div>';
        }

        function clearHistory() {
            state.rttHistory = [];
            state.stats = { online: 0, standby: 0, offline: 0, total: 0 };
            rttChart.data.labels = [];
            rttChart.data.datasets[0].data = [];
            rttChart.data.datasets[1].data = [];
            rttChart.update();
            
            // Reset statistics display
            document.getElementById('stat-online').textContent = '0';
            document.getElementById('stat-standby').textContent = '0';
            document.getElementById('stat-offline').textContent = '0';
            document.getElementById('stat-total').textContent = '0';
            
            addLog('info', 'RTT history cleared');
        }
        
        // ===== EXPORT DATA =====
        function exportData() {
            if (state.rttHistory.length === 0) {
                addLog('warn', 'No data to export');
                return;
            }
            
            // Create CSV content with proper escaping
            const headers = ['Timestamp', 'RTT (ms)', 'Status', 'Screen State'];
            
            // Helper function to escape CSV values
            const escapeCSV = (value) => {
                const str = String(value);
                if (str.includes(',') || str.includes('"') || str.includes('\n') || str.includes('\r')) {
                    return '"' + str.replace(/"/g, '""') + '"';
                }
                return str;
            };
            
            const rows = state.rttHistory.map(h => [
                escapeCSV(new Date(h.timestamp).toISOString()),
                escapeCSV(h.rtt),
                escapeCSV(h.status),
                escapeCSV(h.screenState || 'unknown')
            ]);
            
            const csvContent = [headers.map(escapeCSV), ...rows]
                .map(row => row.join(','))
                .join('\n');
            
            // Create and trigger download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `falcon-tracker-export-${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up the blob URL to prevent memory leak
            URL.revokeObjectURL(url);
            
            addLog('success', `Exported ${state.rttHistory.length} records to CSV`);
        }

        function updateChartTimeframe() {
            const timeframe = parseInt(document.getElementById('chart-timeframe').value);
            state.rttHistory = state.rttHistory.slice(-timeframe);
            updateChart();
        }

        // ===== SETTINGS =====
        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            modal.classList.toggle('hidden');
        }
        
        function toggleHelp() {
            const modal = document.getElementById('help-modal');
            modal.classList.toggle('hidden');
        }

        function loadSettings() {
            const saved = localStorage.getItem('falcon-tracker-settings');
            if (saved) {
                state.settings = { ...state.settings, ...JSON.parse(saved) };
                document.getElementById('probe-interval').value = state.settings.probeInterval;
                document.getElementById('timeout-value').value = state.settings.timeout;
                document.getElementById('backend-url').value = state.settings.backendUrl;
                document.getElementById('screen-threshold').value = state.settings.screenThreshold;
                
                // Update notification toggle UI
                if (state.settings.notifications) {
                    const toggle = document.getElementById('notifications-toggle');
                    const dot = toggle.querySelector('div');
                    toggle.className = 'relative w-12 h-6 rounded-full bg-cyber-glow transition-colors';
                    toggle.setAttribute('aria-checked', 'true');
                    dot.className = 'absolute top-1 right-1 w-4 h-4 rounded-full bg-white transition-transform';
                }
                
                // Update sound alerts toggle UI
                if (state.settings.soundAlerts) {
                    const toggle = document.getElementById('sound-alerts-toggle');
                    const dot = toggle.querySelector('div');
                    toggle.className = 'relative w-12 h-6 rounded-full bg-cyber-glow transition-colors';
                    toggle.setAttribute('aria-checked', 'true');
                    dot.className = 'absolute top-1 right-1 w-4 h-4 rounded-full bg-white transition-transform';
                }
            }
        }

        function saveSettings() {
            state.settings.probeInterval = parseInt(document.getElementById('probe-interval').value);
            state.settings.timeout = parseInt(document.getElementById('timeout-value').value);
            state.settings.backendUrl = document.getElementById('backend-url').value;
            state.settings.screenThreshold = parseInt(document.getElementById('screen-threshold').value);
            
            localStorage.setItem('falcon-tracker-settings', JSON.stringify(state.settings));
            
            showToast('Settings saved successfully', 'success');
            addLog('success', 'Settings saved');
            toggleSettings();
            
            // Restart tracking with new interval if active
            if (state.isTracking && trackingInterval) {
                clearInterval(trackingInterval);
                trackingInterval = setInterval(simulateTracking, state.settings.probeInterval);
            }
        }

        function toggleNotifications() {
            state.settings.notifications = !state.settings.notifications;
            const toggle = document.getElementById('notifications-toggle');
            const dot = toggle.querySelector('div');
            
            if (state.settings.notifications) {
                toggle.className = 'relative w-12 h-6 rounded-full bg-cyber-glow transition-colors';
                toggle.setAttribute('aria-checked', 'true');
                dot.className = 'absolute top-1 right-1 w-4 h-4 rounded-full bg-white transition-transform';
                
                if (Notification.permission !== 'granted') {
                    Notification.requestPermission();
                }
            } else {
                toggle.className = 'relative w-12 h-6 rounded-full bg-gray-700 transition-colors';
                toggle.setAttribute('aria-checked', 'false');
                dot.className = 'absolute top-1 left-1 w-4 h-4 rounded-full bg-white transition-transform';
            }
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', (e) => {
            // Close modals with Escape
            if (e.key === 'Escape') {
                const settingsModal = document.getElementById('settings-modal');
                const helpModal = document.getElementById('help-modal');
                if (!settingsModal.classList.contains('hidden')) {
                    toggleSettings();
                }
                if (!helpModal.classList.contains('hidden')) {
                    toggleHelp();
                }
            }
            
            // Save settings with Ctrl+S
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                const settingsModal = document.getElementById('settings-modal');
                if (!settingsModal.classList.contains('hidden')) {
                    saveSettings();
                }
            }
            
            // Open settings with Ctrl+,
            if (e.ctrlKey && e.key === ',') {
                e.preventDefault();
                toggleSettings();
            }
            
            // Show help with ?
            if (e.key === '?' && !e.ctrlKey && !e.altKey) {
                const activeElement = document.activeElement;
                if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    toggleHelp();
                }
            }
            
            // Export data with Ctrl+E
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
            
            // Clear history with Ctrl+L
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                clearHistory();
            }
            
            // Toggle privacy mode with Ctrl+P (without shift)
            if (e.ctrlKey && e.key === 'p' && !e.shiftKey) {
                e.preventDefault();
                togglePrivacyMode();
            }
            
            // Print report with Ctrl+Shift+P
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                printReport();
            }
        });
        
        // ===== LEGAL DISCLAIMER =====
        function acceptDisclaimer() {
            const checkbox = document.getElementById('consent-checkbox');
            if (checkbox && checkbox.checked) {
                state.ui.disclaimerAccepted = true;
                localStorage.setItem('falcon-tracker-disclaimer-accepted', 'true');
                document.getElementById('legal-disclaimer-modal').classList.add('hidden');
                addAuditLog('Disclaimer accepted');
                showToast('Welcome to Falcon Tracker', 'success');
            }
        }
        
        function checkDisclaimer() {
            const accepted = localStorage.getItem('falcon-tracker-disclaimer-accepted');
            if (accepted === 'true') {
                state.ui.disclaimerAccepted = true;
                document.getElementById('legal-disclaimer-modal')?.classList.add('hidden');
            }
        }
        
        // Enable accept button when checkbox is checked
        document.getElementById('consent-checkbox')?.addEventListener('change', function() {
            document.getElementById('accept-disclaimer-btn').disabled = !this.checked;
        });
        
        // ===== PIN LOCK =====
        function handlePinInput(input) {
            const index = parseInt(input.dataset.index);
            if (input.value.length === 1 && index < 3) {
                const nextInput = document.querySelector('.pin-digit[data-index="' + (index + 1) + '"]');
                if (nextInput) nextInput.focus();
            }
            const allInputs = document.querySelectorAll('.pin-digit');
            const pin = Array.from(allInputs).map(i => i.value).join('');
            if (pin.length === 4) verifyPin(pin);
        }
        
        function handlePinKeydown(e, input) {
            const index = parseInt(input.dataset.index);
            if (e.key === 'Backspace' && input.value === '' && index > 0) {
                const prevInput = document.querySelector('.pin-digit[data-index="' + (index - 1) + '"]');
                if (prevInput) prevInput.focus();
            }
        }
        
        function verifyPin(enteredPin) {
            if (enteredPin === state.settings.pin) {
                state.ui.isLocked = false;
                document.getElementById('pin-lock-screen')?.classList.add('hidden');
                document.querySelectorAll('.pin-digit').forEach(i => i.value = '');
            } else {
                document.getElementById('pin-error')?.classList.remove('hidden');
                document.querySelectorAll('.pin-digit').forEach(i => i.value = '');
                document.querySelector('.pin-digit[data-index="0"]')?.focus();
            }
        }
        
        // ===== ACCESSIBILITY =====
        function toggleAccessibilityMenu() {
            document.getElementById('accessibility-menu')?.classList.toggle('hidden');
        }
        
        function toggleHighContrast() {
            state.ui.highContrast = !state.ui.highContrast;
            document.getElementById('high-contrast-status').textContent = state.ui.highContrast ? 'On' : 'Off';
            document.documentElement.classList.toggle('high-contrast', state.ui.highContrast);
        }
        
        function toggleReducedMotion() {
            state.ui.reducedMotion = !state.ui.reducedMotion;
            document.getElementById('reduced-motion-status').textContent = state.ui.reducedMotion ? 'On' : 'Off';
            document.documentElement.classList.toggle('reduced-motion', state.ui.reducedMotion);
        }
        
        function changeFontSize(size) {
            state.ui.fontSize = size;
            document.body.classList.remove('font-size-small', 'font-size-normal', 'font-size-large', 'font-size-xlarge');
            document.body.classList.add('font-size-' + size);
        }
        
        // ===== FULLSCREEN & STEALTH =====
        function toggleFullscreen() {
            state.ui.fullscreen = !state.ui.fullscreen;
            if (state.ui.fullscreen) {
                if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
                showToast('Fullscreen enabled', 'info');
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }
        
        function toggleStealthMode() {
            state.ui.stealthMode = !state.ui.stealthMode;
            document.body.classList.toggle('stealth-mode', state.ui.stealthMode);
            document.title = state.ui.stealthMode ? 'Document' : 'Falcon Tracker | RTT Analysis Dashboard';
            if (state.ui.stealthMode) showToast('Stealth mode enabled', 'info');
        }
        
        // ===== ALERT RULES =====
        function openAlertRuleModal() { showToast('Alert rule creation coming soon', 'info'); }
        
        function toggleAlertRule(index) {
            if (state.alertRules[index]) {
                state.alertRules[index].enabled = !state.alertRules[index].enabled;
                updateAlertRulesList();
            }
        }
        
        function updateAlertRulesList() {
            const list = document.getElementById('alert-rules-list');
            if (!list) return;
            list.innerHTML = state.alertRules.map((r, i) => 
                '<div class="alert-rule ' + (r.enabled ? 'alert-rule-active' : 'alert-rule-inactive') + ' p-3 rounded-lg bg-cyber-darker">' +
                '<div class="flex items-center justify-between">' +
                '<div><p class="text-sm font-medium">' + escapeHtml(r.name) + '</p><p class="text-xs text-gray-500">' + (r.timeStart || '') + ' - ' + (r.timeEnd || '') + '</p></div>' +
                '<button onclick="toggleAlertRule(' + i + ')" class="px-2 py-1 text-xs ' + (r.enabled ? 'bg-cyber-glow/20 text-cyber-glow' : 'bg-gray-700') + ' rounded">' + (r.enabled ? 'On' : 'Off') + '</button>' +
                '</div></div>'
            ).join('');
        }
        
        // ===== WEBHOOKS =====
        function saveWebhookSettings() {
            state.webhooks.discord = document.getElementById('discord-webhook')?.value || '';
            state.webhooks.telegramToken = document.getElementById('telegram-token')?.value || '';
            state.webhooks.telegramChatId = document.getElementById('telegram-chat-id')?.value || '';
            localStorage.setItem('falcon-tracker-webhooks', JSON.stringify(state.webhooks));
            addAuditLog('Webhooks saved');
            showToast('Webhooks saved', 'success');
        }
        
        // ===== SESSION MANAGEMENT =====
        function saveCurrentSession() {
            const name = prompt('Enter session name:');
            if (!name) return;
            state.savedSessions.push({
                id: Date.now(),
                name: name,
                rttHistory: [...state.rttHistory],
                stats: {...state.stats},
                notes: document.getElementById('session-notes')?.value || '',
                tags: [...state.sessionTags],
                savedAt: new Date().toISOString()
            });
            localStorage.setItem('falcon-tracker-sessions', JSON.stringify(state.savedSessions));
            updateSavedSessionsList();
            addAuditLog('Session saved: ' + name);
            showToast('Session saved', 'success');
        }
        
        function updateSavedSessionsList() {
            const list = document.getElementById('saved-sessions-list');
            if (!list) return;
            if (state.savedSessions.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-center py-4 text-sm">No saved sessions</div>';
                return;
            }
            list.innerHTML = state.savedSessions.map(s => 
                '<div class="flex items-center justify-between p-2 rounded-lg bg-cyber-darker">' +
                '<span class="text-sm">' + escapeHtml(s.name) + '</span>' +
                '<button onclick="loadSession(' + s.id + ')" class="text-xs text-cyber-info">Load</button></div>'
            ).join('');
        }
        
        function loadSession(id) {
            const session = state.savedSessions.find(s => s.id === id);
            if (session) {
                state.rttHistory = session.rttHistory || [];
                state.stats = session.stats;
                if (document.getElementById('session-notes')) document.getElementById('session-notes').value = session.notes || '';
                updateChart();
                addAuditLog('Session loaded: ' + session.name);
                showToast('Session loaded', 'success');
            }
        }
        
        function addSessionTag(tag) {
            if (!state.sessionTags.includes(tag)) {
                state.sessionTags.push(tag);
                showToast('Tag added: ' + tag, 'info');
            }
        }
        
        function bookmarkCurrentEvent() {
            if (state.rttHistory.length === 0) {
                showToast('No events to bookmark', 'warning');
                return;
            }
            state.bookmarkedEvents.push({...state.rttHistory[state.rttHistory.length - 1], bookmarkedAt: new Date().toISOString()});
            addAuditLog('Event bookmarked');
            showToast('Event bookmarked', 'success');
        }
        
        // ===== DATA MANAGEMENT =====
        function exportAllData() {
            const data = {
                rttHistory: state.rttHistory,
                sessions: state.savedSessions,
                settings: state.settings,
                auditLog: state.auditLog,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'falcon-tracker-backup-' + new Date().toISOString().slice(0,10) + '.json';
            link.click();
            URL.revokeObjectURL(link.href);
            addAuditLog('Data exported');
            showToast('Backup exported', 'success');
        }
        
        function importData() { document.getElementById('import-file-input')?.click(); }
        
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.rttHistory) state.rttHistory = data.rttHistory;
                    if (data.sessions) state.savedSessions = data.sessions;
                    if (data.settings) state.settings = {...state.settings, ...data.settings};
                    updateChart();
                    updateSavedSessionsList();
                    addAuditLog('Data imported');
                    showToast('Data restored', 'success');
                } catch (err) {
                    showToast('Invalid backup file', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function clearAllData() {
            if (!confirm('Clear all data? This cannot be undone.')) return;
            state.rttHistory = [];
            state.stats = {online: 0, standby: 0, offline: 0, total: 0};
            state.savedSessions = [];
            state.auditLog = [];
            localStorage.clear();
            updateChart();
            updateSavedSessionsList();
            showToast('Data cleared', 'info');
        }
        
        // ===== AUDIT LOG =====
        function addAuditLog(action) {
            if (!state.settings.auditLogging) return;
            state.auditLog.push({timestamp: new Date().toISOString(), action: action});
            updateAuditLogDisplay();
            if (state.auditLog.length > 500) state.auditLog = state.auditLog.slice(-500);
        }
        
        function updateAuditLogDisplay() {
            const container = document.getElementById('audit-log');
            if (!container || state.auditLog.length === 0) return;
            container.innerHTML = state.auditLog.slice(-20).reverse().map(e => 
                '<div class="p-2 text-gray-400">' + new Date(e.timestamp).toLocaleTimeString() + ' - ' + escapeHtml(e.action) + '</div>'
            ).join('');
        }
        
        function exportAuditLog() {
            const csv = 'Timestamp,Action\n' + state.auditLog.map(e => e.timestamp + ',"' + e.action.replace(/"/g, '""') + '"').join('\n');
            const blob = new Blob([csv], {type: 'text/csv'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'audit-log-' + new Date().toISOString().slice(0,10) + '.csv';
            link.click();
            showToast('Audit log exported', 'success');
        }
        
        // ===== ANALYTICS INITIALIZATION =====
        function initHeatmapCalendar() {
            const container = document.getElementById('heatmap-calendar');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 371; i++) {
                const cell = document.createElement('div');
                cell.className = 'heatmap-cell heatmap-level-0';
                const date = new Date();
                date.setDate(date.getDate() - (370 - i));
                cell.title = date.toLocaleDateString();
                container.appendChild(cell);
            }
        }
        
        function initPeakHoursChart() {
            const container = document.getElementById('peak-hours-chart');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const bar = document.createElement('div');
                bar.className = 'flex-1 rounded-t bg-gray-700/50 transition-all';
                bar.style.height = '10%';
                bar.title = i.toString().padStart(2, '0') + ':00';
                container.appendChild(bar);
            }
        }
        
        function initRttHistogram() {
            const container = document.getElementById('rtt-histogram');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const bar = document.createElement('div');
                bar.className = 'histogram-bar flex-1 rounded-t bg-cyber-info/50';
                bar.style.height = '10%';
                bar.title = (i * 500) + '-' + ((i + 1) * 500) + 'ms';
                container.appendChild(bar);
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ===== EXTENDED INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            checkDisclaimer();
            initHeatmapCalendar();
            initPeakHoursChart();
            initRttHistogram();
            
            // Load saved data
            const savedSessions = localStorage.getItem('falcon-tracker-sessions');
            if (savedSessions) state.savedSessions = JSON.parse(savedSessions);
            
            const savedWebhooks = localStorage.getItem('falcon-tracker-webhooks');
            if (savedWebhooks) {
                state.webhooks = JSON.parse(savedWebhooks);
                if (document.getElementById('discord-webhook')) document.getElementById('discord-webhook').value = state.webhooks.discord || '';
                if (document.getElementById('telegram-token')) document.getElementById('telegram-token').value = state.webhooks.telegramToken || '';
                if (document.getElementById('telegram-chat-id')) document.getElementById('telegram-chat-id').value = state.webhooks.telegramChatId || '';
            }
            
            updateSavedSessionsList();
            updateAlertRulesList();
            
            // Close accessibility menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#accessibility-btn') && !e.target.closest('#accessibility-menu')) {
                    document.getElementById('accessibility-menu')?.classList.add('hidden');
                }
            });
            
            addAuditLog('Dashboard initialized');
        });
    </script>
</body>
</html>
